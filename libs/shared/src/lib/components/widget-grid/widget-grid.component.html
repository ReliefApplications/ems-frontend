<ng-container *ngIf="!loading; else emptyTemplate">
  <!-- NEW WIDGETS -->
  <div
    class="widget-choice-wrapper"
    *ngIf="canUpdate"
    [ngClass]="{ 'floating-widget-choice-wrapper': widgets.length > 0 }"
  >
    <h2 *ngIf="widgets.length === 0">{{ 'models.widget.add' | translate }}</h2>
    <shared-widget-choice
      [floating]="widgets.length > 0"
      [widgetTypes]="availableWidgets"
      (add)="onAdd($event)"
    >
    </shared-widget-choice>
  </div>
  <!-- GRID OF WIDGETS -->
  <gridster [options]="gridOptions">
    <gridster-item
      [item]="widget"
      *ngFor="let widget of widgets; let i = index"
    >
      <shared-widget
        #widgetElement
        [widget]="widget"
        (changeStep)="triggerChangeStepAction($event)"
        (edit)="onEditWidget($event)"
        [canUpdate]="canUpdate"
        [headerLeftTemplate]="headerLeftTemplate"
        [headerRightTemplate]="headerRightTemplate"
      ></shared-widget>
      <!-- Left header template -->
      <ng-template #headerLeftTemplate>
        <!-- Drag n drop indicator -->
        <ui-button
          *ngIf="canUpdate"
          icon="drag_indicator"
          class="cursor-grab -ml-3 pointer-events-none"
          variant="grey"
          [isIcon]="true"
          [uiTooltip]="'models.page.tooltip.drag' | translate"
        >
        </ui-button>
      </ng-template>
      <!-- Right header template -->
      <ng-template #headerRightTemplate let-id>
        <!-- Widget actions -->
        <shared-widget-actions
          class="-mr-3"
          [id]="id"
          [canUpdate]="canUpdate"
          [collapsed]="
            widgetComponents.get(i)?.elementRef?.nativeElement.clientWidth < 500
          "
          [widget]="widget"
          (edit)="onEditWidget($event)"
          (delete)="onDeleteWidget($event)"
          (expand)="onExpandWidget($event)"
          (style)="onStyleWidget($event)"
        >
        </shared-widget-actions>
      </ng-template>
    </gridster-item>
  </gridster>
  <!-- <kendo-tilelayout
    [columns]="colsNumber"
    [rowHeight]="200"
    [resizable]="canUpdate"
    [reorderable]="canUpdate"
    (reorder)="onReorder($event)"
    (resize)="onResize($event)"
    class="-m-4"
  >
    <kendo-tilelayout-item
      *ngFor="let widget of widgets; let i = index"
      class="!rounded-lg !border focus-within:ring-2 focus-within:ring-primary-500 focus-within:ring-offset-2"
      [ngClass]="{
        '!shadow-sm !border-gray-300':
          widget.settings.widgetDisplay?.showBorder ?? true,
        '!border-transparent': !(
          widget.settings.widgetDisplay?.showBorder ?? true
        ),
        'hover:!border-gray-400 hover:!shadow-sm': canUpdate
      }"
    >
    </kendo-tilelayout-item>
  </kendo-tilelayout> -->
</ng-container>
<!-- LOADING INDICATOR -->
<ng-template #emptyTemplate>
  <div class="mt-6">
    <kendo-tilelayout [rowHeight]="200" [columns]="colsNumber" class="-m-4">
      <kendo-tilelayout-item
        *ngFor="let skeleton of skeletons"
        [colSpan]="skeleton.colSpan"
        [rowSpan]="skeleton.rowSpan"
      >
        <kendo-skeleton
          shape="rectangle"
          animation="pulse"
          [width]="'100%'"
          [height]="'100%'"
        ></kendo-skeleton>
      </kendo-tilelayout-item>
    </kendo-tilelayout>
  </div>
</ng-template>
