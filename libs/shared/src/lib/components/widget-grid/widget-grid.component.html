<!-- NEW WIDGETS -->
<div
  class="widget-choice-wrapper"
  *ngIf="canUpdate"
  [ngClass]="{ 'floating-widget-choice-wrapper': widgets.length > 0 }"
>
  <h2 *ngIf="widgets.length === 0">{{ 'models.widget.add' | translate }}</h2>
  <shared-widget-choice
    [floating]="widgets.length > 0"
    [widgetTypes]="availableWidgets"
    (add)="onAdd($event)"
  >
  </shared-widget-choice>
</div>
<!-- GRID OF WIDGETS -->
<ng-container *ngIf="widgets.length > 0">
  <gridster [options]="options">
    <ng-container *ngIf="loading; else widgetGridTmpl">
      <gridster-item [item]="skeleton" *ngFor="let skeleton of skeletons">
        <div class="gridster-item-content h-full">
          <kendo-skeleton
            shape="rectangle"
            animation="pulse"
            [width]="'100%'"
            [height]="'100%'"
          ></kendo-skeleton>
        </div>
      </gridster-item>
    </ng-container>
    <ng-template #widgetGridTmpl>
      <gridster-item
        [item]="item"
        *ngFor="let item of dashboard; let i = index"
      >
        <div class="gridster-item-content h-full">
          <!-- Settings -->
          <shared-floating-options
            *ngIf="canUpdate"
            class="absolute top-0 right-0 z-[1100]"
            [widget]="widgets[i]"
            (edit)="onEditWidget($event)"
            (delete)="onDeleteWidget($event)"
            (expand)="onExpandWidget($event)"
          >
          </shared-floating-options>
          <shared-widget
            [widget]="widgets[i]"
            (changeStep)="changeStep.emit($event)"
            [id]="'widget-' + widgets[i].id"
            (edit)="onEditWidget($event)"
            [canUpdate]="canUpdate ?? false"
            class="bg-white"
          ></shared-widget>
          <!-- Expand button -->
          <ui-button
            *ngIf="!canUpdate"
            [isIcon]="true"
            icon="open_in_full"
            variant="grey"
            class="absolute top-0 right-0 z-[1100]"
            (click)="onExpandWidget(widgets[i])"
          >
          </ui-button>
        </div>
        <!-- Move widget -->
        <div class="cursor-grab absolute top-2 left-2 z-[1100]">
          <ui-icon
            *ngIf="canUpdate"
            icon="drag_indicator"
            class="pointer-events-none"
            variant="grey"
          >
          </ui-icon>
        </div>
      </gridster-item>
    </ng-template>
  </gridster>
</ng-container>
