<!-- Loading indicator -->
<ui-spinner class="flex justify-center items-center " *ngIf="loading"></ui-spinner>

<ng-container *ngIf="!loading && form; else emptyTmpl">
    <!-- Enable mapping checkbox -->
    <ui-checkbox
      class="ml-2"
      (click)="$event.stopPropagation()"
      (change)="toggleMapping()"
      [checked]="enableMapping"
      [ariaLabel]="'components.widget.form.mapQuestionState' | translate"
      >
        <ng-container ngProjectAs="label">
          {{ 'components.widget.form.mapQuestionState' | translate }}
        </ng-container>
    </ui-checkbox>

  <div *ngIf="enableMapping && mappings" class="ml-2">
    <!-- Add new mapping button -->
    <ui-button
      class="my-2"
      category="secondary"
      variant="primary"
      (click)="addMapping()">
      {{ 'components.widget.form.addNewMapping' | translate }}
    </ui-button>
    <!-- Mappings -->
    <form [formGroup]="formGroup" class="flex">
      <div
        formArrayName="mapQuestionState"
        *ngIf="mappings.length > 0"
        class="flex flex-col"
      >
        <ng-container *ngFor="let mapping of mappings.controls; let i = index">
          <!-- Nested mapping rules -->
          <shared-map-question-state-rule
            [form]="$any(mapping)"
            [questions]="questions"
            [states]="states"
            (delete)="deleteMapping(i)"
          ></shared-map-question-state-rule>
        </ng-container>
      </div>
    </form>
  </div>
</ng-container>

<!-- Empty template -->
<ng-template #emptyTmpl>
  <shared-empty *ngIf="!loading" [title]="'components.role.summary.noForm' | translate">
  </shared-empty>
</ng-template>
