<ui-spinner size="large" *ngIf="loading"></ui-spinner>
<ng-container *ngIf="!loading">
  <div class="flex">
    <!-- Selection of fields -->
    <shared-tagbox
      class="flex flex-1"
      [choices$]="fields$"
      [control]="$any(aggregationForm.get('sourceFields'))"
      [label]="'components.aggregationBuilder.sourceFields' | translate"
    ></shared-tagbox>
  </div>
  <!-- Pipeline builder -->
  <div class="flex pipeline-content">
    <shared-pipeline
      [fields$]="selectedFields$"
      [metaFields$]="metaFields$"
      [pipelineForm]="pipelineForm"
      (previewPipelineForm)="onPreviewPipelineFormChange($event)"
    ></shared-pipeline>
    <div class="aggregation-preview">{{ aggregationPreview | json }} oii</div>
  </div>
  <ui-button icon="remove_red_eye" category="primary" (click)="togglePreview()">
    {{ 'components.aggregationBuilder.togglePreview' | translate }}
  </ui-button>
</ng-container>
