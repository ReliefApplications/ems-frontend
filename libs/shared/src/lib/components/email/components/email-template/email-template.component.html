<div>
  <div class="flex flex-row gap-2" [formGroup]="segmentForm">
    <!-- Select type of email input ( manual / from list / from resource ) -->
    <div class="w-1/3" uiFormFieldDirective [defaultMargin]="false">
      <label>{{
        'components.notifications.email.dropdown.emailInput' | translate
      }}</label>
      <ui-select-menu
        id="segmentSelect"
        formControlName="segment"
        (ngModelChange)="onSegmentChange($event)"
        class="w-full"
      >
        <ui-select-option
          *ngFor="let segment of segmentList"
          [value]="segment"
          >{{ segment | titlecase }}</ui-select-option
        >
      </ui-select-menu>
    </div>
    <!-- Manual input -->
    <div class="w-1/3" *ngIf="activeSegmentIndex === 0" uiFormFieldDirective>
      <label>{{ 'components.select.distribution.email' | translate }}</label>
      <ui-icon
        icon="info_outline"
        class="cursor-help"
        variant="grey"
        [uiTooltip]="'components.select.distribution.emailError' | translate"
        uiSuffix
      ></ui-icon>
      <input
        #filterInput
        (keyup.enter)="addEmailManually(filterInput)"
        (change)="validateEmail(filterInput)"
        autocomplete="off"
        aria-autocomplete="none"
        type="text"
        [placeholder]="'components.select.distribution.email' | translate"
      />
    </div>
    <!-- Selection of resource -->
    <div class="w-1/2" *ngIf="activeSegmentIndex >= 1">
      <label
        htmlFor="select__data__set"
        class="block text-sm font-medium leading-6 text-gray-900"
      >
        {{ 'components.queryBuilder.dataset.title' | translate }}*
      </label>
      <ng-select
        id="select__data__set"
        name="select__data__set"
        [(ngModel)]="selectedDataset"
        [ngModelOptions]="{ standalone: true }"
        [items]="datasets"
        bindLabel="blockName"
        [searchable]="true"
        [virtualScroll]="true"
        (clear)="clearDatasetSelection()"
        (change)="bindDataSetDetails($event)"
        [placeholder]="'components.queryBuilder.dataset.select' | translate"
      >
        <ng-template disabled selected>
          <span>{{
            'components.queryBuilder.dataset.select' | translate
          }}</span>
        </ng-template>
        <ng-template
          ng-option-tmp
          let-item="item"
          let-index="index"
          let-search="searchTerm"
        >
          <span>{{
            this.emailService.replaceUnderscores(item.blockName || '')
              | titlecase
          }}</span>
        </ng-template>
      </ng-select>
    </div>
  </div>

  <!-- From resource filter -->
  <div *ngIf="activeSegmentIndex === 2">
    <!-- Filter editor -->
    <div></div>
  </div>
  <div class="loadingSign" [ngClass]="{ active: loading }">
    <ui-spinner *ngIf="loading" style="position: relative"></ui-spinner>
  </div>
  <div uiChipList>
    <ui-chip
      variant="primary"
      class="text-xl px-1"
      [removable]="true"
      (removed)="removeEmailChip(chipIndex)"
      *ngFor="let emailText of selectedEmails; let chipIndex = index"
      >{{ emailText }}</ui-chip
    >
  </div>

  <!-- From list ( selected from resource ) -->
  <div
    class="overflow-hidden mt-2"
    *ngIf="activeSegmentIndex === 1 || showPreview"
  >
    <div></div>
  </div>

  <div *ngIf="activeSegmentIndex === 2 && showBtnPreview">
    <!-- Apply filter -->
    <ui-button
      *ngIf="datasetFilterInfo.controls"
      class="float-right mt-8"
      category="secondary"
      variant="primary"
      (click)="applyFilter('')"
    >
      {{ 'components.queryBuilder.filter.apply' | translate }}
    </ui-button>
    <!-- Preview dataset -->
    <ui-button
      class="float-right mt-8 mr-2"
      category="secondary"
      variant="primary"
      (click)="applyFilter('')"
    >
      {{ 'common.preview' | translate }}
    </ui-button>
  </div>
</div>
