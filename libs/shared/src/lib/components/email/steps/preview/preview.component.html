<!-- Loading indicator -->
<ui-spinner
  class="flex justify-center items-center h-screen"
  *ngIf="emailService.loading"
></ui-spinner>
<div>
  <div class="w-full">
    <!-- Distribution List -->
    <div class="mb-4">
      <h2>{{ 'components.email.distributionList.name' | translate }}</h2>
      <p>
        {{ this.emailService.datasetsForm.value.emailDistributionList.name }}
      </p>
    </div>

    <!-- To -->
    <div class="mb-4">
      <h2>{{ 'components.select.distribution.to' | translate }}:</h2>
      <ul class="list-none space-y-1">
        <div uiChipList>
          <ng-container *ngFor="let email of distributionListTo; let i = index">
            <ui-chip
              *ngIf="i < 6 || isExpandedTo"
              variant="primary"
              class="w-full flex-row flex-wrap justify-between mr-1"
              >{{ email }}</ui-chip
            >
          </ng-container>
        </div>
        <ui-button
          *ngIf="distributionListTo.length > 6 && !isExpandedTo"
          class="inline-block"
          (click)="toggleExpandTo()"
          >{{
            'components.email.preview.more'
              | translate : { length: distributionListTo.length - 6 }
          }}</ui-button
        >
        <ui-button
          *ngIf="isExpandedTo"
          class="inline-block"
          (click)="toggleExpandTo()"
          >{{ 'components.email.preview.less' | translate }}</ui-button
        >
      </ul>
    </div>

    <!-- Subscription List -->
    <div
      class="mb-4"
      *ngIf="
        query.subscriptionList?.length > 0 &&
        query.restrictSubscription === false
      "
    >
      <h3>
        {{ 'components.select.distribution.subscriptionList' | translate }}:
      </h3>
      <ul class="list-none space-y-1">
        <div uiChipList>
          <ng-container
            *ngFor="let email of query?.subscriptionList; let i = index"
          >
            <ui-chip
              *ngIf="i < 6 || isExpandedSubscription"
              variant="primary"
              class="w-full flex-row flex-wrap justify-between mr-1"
              >{{ email }}</ui-chip
            >
          </ng-container>
        </div>
        <ui-button
          *ngIf="query?.subscriptionList?.length > 6 && !isExpandedSubscription"
          class="inline-block"
          (click)="toggleExpandSubscription()"
          >{{
            'components.email.preview.more'
              | translate : { length: query?.subscriptionList.length - 6 }
          }}</ui-button
        >
        <ui-button
          *ngIf="isExpandedSubscription"
          class="inline-block"
          (click)="toggleExpandSubscription()"
          >{{ 'components.email.preview.less' | translate }}</ui-button
        >
      </ul>
    </div>

    <!-- CC -->
    <div *ngIf="distributionListCc.length > 0" class="mb-4">
      <h2>{{ 'components.select.distribution.cc' | translate }}:</h2>
      <ul class="list-none space-y-1">
        <div uiChipList>
          <ng-container *ngFor="let email of distributionListCc; let i = index">
            <ui-chip
              *ngIf="i < 6 || isExpandedCc"
              variant="primary"
              class="w-full flex-row flex-wrap justify-between mr-1"
              >{{ email }}</ui-chip
            >
          </ng-container>
        </div>
        <ui-button
          *ngIf="distributionListCc.length > 6 && !isExpandedCc"
          variant="primary"
          class="inline-block"
          (click)="toggleExpandCc()"
          >{{
            'components.email.preview.more'
              | translate : { length: distributionListCc.length - 6 }
          }}</ui-button
        >
        <ui-button
          *ngIf="isExpandedCc"
          variant="primary"
          class="inline-block"
          (click)="toggleExpandCc()"
          >{{ 'components.email.preview.less' | translate }}</ui-button
        >
      </ul>
    </div>

    <!-- BCC -->
    <div *ngIf="distributionListBcc.length > 0" class="mb-4">
      <h2>{{ 'components.select.distribution.bcc' | translate }}:</h2>
      <ul class="list-none space-y-1">
        <div uiChipList>
          <ng-container
            *ngFor="let email of distributionListBcc; let i = index"
          >
            <ui-chip
              *ngIf="i < 6 || isExpandedBcc"
              variant="primary"
              class="mr-1"
              >{{ email }}</ui-chip
            >
          </ng-container>
        </div>
        <ui-button
          *ngIf="distributionListBcc.length > 6 && !isExpandedBcc"
          variant="primary"
          class="inline-block"
          (click)="toggleExpandBcc()"
          >{{
            'components.email.preview.more'
              | translate : { length: distributionListBcc.length - 6 }
          }}</ui-button
        >
        <ui-button
          *ngIf="isExpandedBcc"
          variant="primary"
          class="inline-block"
          (click)="toggleExpandBcc()"
          >{{ 'components.email.preview.less' | translate }}
        </ui-button>
      </ul>
    </div>

    <!-- Subject -->
    <p>{{ 'components.email.preview.subject' | translate }}</p>
    <div id="subjectHtml" #subjectHtmlRef class="w-full"></div>
  </div>
</div>
<div class="overflow-y-scroll">
  <div class="h-fit mb-3" #emailHTMLRef id="emailContainer"></div>
</div>
