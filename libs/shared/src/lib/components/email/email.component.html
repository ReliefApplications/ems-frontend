<ng-container *ngIf="this.ability.can('read', 'EmailNotification') && !showTemplateCreationWizard">
  <ui-spinner *ngIf="emailService.emailListLoading && emailService.isExisting" class="spinner"></ui-spinner>
  <div class="container emailListContainer py-8 flex justify-between" *ngIf="emailService.isExisting">
    <div
    uiFormFieldDirective
    [defaultMargin]="false"
    class="p-4 flex max-sm:flex-auto"
  >
    <ui-icon icon="search" uiPrefix></ui-icon>
    <input
      id="exampleSelect"
      type="text"
      (input)="searchTemplate($event)"
      [placeholder]="'common.placeholder.search' | translate"
      class="w-64 relative flex py-0.5 px-2rounded-md border-0 items-center"
    />
  </div>
  
  <div class="p-4" [ngSwitch]="selectedTabIndex">
    <ng-container *ngIf="this.ability.can('create', 'EmailNotification')">
      <ui-button
      class="float-right"
      icon="add"
      category="secondary"
      variant="primary"
      (click)="toggle(true)"        
      *ngSwitchCase="0"
      >
      {{  'components.email.notification.create' | translate  }}
      </ui-button>
    </ng-container>
    <ng-container *ngIf="this.ability.can('create', 'EmailNotification')">
      <ui-button
          class="float-right"
          icon="add"
          category="secondary"
          variant="primary"
          (click)="distributionListDialogHandler()"
          *ngSwitchCase="1"
        >
          Create Distribution List
      </ui-button>
    </ng-container>
      <ng-container *ngIf="this.ability.can('create', 'EmailNotification')">
        <ui-button
            class="float-right"
            icon="add"
            category="secondary"
            variant="primary"
            (click)="createTemplate()"
            *ngSwitchCase="2"
        >
            Custom Template
        </ui-button>
      </ng-container>

    <br>
  </div>
  </div>
  
  <div *ngIf="emailService.isExisting">
    <ui-tabs (openedTab)="selectedTabIndex = $event.index"
    (selectedIndexChange)="onTabSelect($event)">
      <!-- Email Notification List -->
      <ui-tab>
        <ng-container ngProjectAs="label">{{
          'components.email.notification.list' | translate
        }}</ng-container>
          <div class="mt-4 overflow-x-hidden shadow-2lg">
            <ng-container *ngIf="emailNotifications?.length && this.ability.can('read', 'EmailNotification'); else emptyTmpl">
              <div class="overflow-x-auto">
                <table cdk-table uiTableWrapper [dataSource]="emailNotifications">
                  <ng-container cdkColumnDef="name">
                    <th uiCellHeader *cdkHeaderCellDef scope="col">
                      <span class="headerTitle">
                        {{ 'common.name' | translate }}
                      </span>
                    </th>
                    <td uiCell *cdkCellDef="let element" class="max-w-[30vw]">
                      {{ element.name }}
                    </td>
                  </ng-container>
                  <ng-container cdkColumnDef="alerttype">
                    <th uiCellHeader *cdkHeaderCellDef scope="col">
                      <span class="headerTitle">
                        {{'components.email.notification.type' | translate}}
                      </span>
                    </th>
                    <td uiCell *cdkCellDef="let element">
                      <button
                      type="button"
                      class="cursor-text py-0.5 px-2 font-medium text-blue-600 rounded-full flex focus:ring-4 bg-blue-50 dark:border-blue-500"
                    >
                      <svg
                        class="w-3 h-3 mt-1 text-blue-500 me-2"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 20 16"
                      >
                        <path
                          d="m10.036 8.278 9.258-7.79A1.979 1.979 0 0 0 18 0H2A1.987 1.987 0 0 0 .641.541l9.395 7.737Z"
                        />
                        <path
                          d="M11.241 9.817c-.36.275-.801.425-1.255.427-.428 0-.845-.138-1.187-.395L0 2.6V14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2.5l-8.759 7.317Z"
                        />
                      </svg>
                      {{ element.notificationType }}
                    </button>
                    </td>
                  </ng-container>
                           
                  <ng-container cdkColumnDef="createdby">
                    <th uiCellHeader *cdkHeaderCellDef scope="col">
                      <span class="headerTitle">
                        {{ 'models.customNotification.lastExecution' | translate }}
                      </span>
                    </th>
                    <td uiCell *cdkCellDef="let element">
                      {{element?.createdBy?.name}}
                    </td>
                  </ng-container>
                  <div *ngIf="this.ability.can('update', 'EmailNotification'); else elseBlock">
                  <ng-container cdkColumnDef="actions" [stickyEnd]="true">
                    <th uiCellHeader *cdkHeaderCellDef scope="col" class="w-16"></th>
                    <td uiCell *cdkCellDef="let element" class="flex items-center">
                      <ng-container>
                          <ui-button
                            [variant]="'grey'"
                            class="hide-icons hover:text-primary-600"
                            [isIcon]="true"
                            size="large"
                            (click)="sendEmailList(element)"
                            [icon]="'forward_to_inbox'"
                            [uiTooltip]="'common.sendEmail' | translate"
                          >
                        </ui-button>
        
                        <ui-button
                            [variant]="'grey'"
                            class="hide-icons hover:text-primary-600"
                            [isIcon]="true"
                            size="large"
                            (click)="getEmailNotificationById(element.id)"
                            [icon]="'edit'"
                            [uiTooltip]="'Edit'"
                          >
                        </ui-button>
        
                        <ui-button
                            [variant]="'grey'"
                            class="hide-icons hover:text-primary-600"
                            [isIcon]="true"
                            size="large"
                            (click)="cloneEmailNotification(element)"
                            [icon]="'content_copy'"
                            [uiTooltip]="'Clone'"
                          >
                        </ui-button>
        
                        <ui-button
                            [variant]="'danger'"
                            class="hide-icons hover:text-primary-600"
                            [isIcon]="true"
                            size="large"
                            (click)="deleteEmailNotification(element)"
                            [icon]="'delete'"
                            [uiTooltip]="'Delete'"
                          >
                        </ui-button>
                      </ng-container>
                    </td>
                  </ng-container>
                  </div>
                  <ng-template #elseBlock>
                    <ng-container cdkColumnDef="actions" [stickyEnd]="true">
                      <th uiCellHeader *cdkHeaderCellDef scope="col" class="w-16"></th>
                      <td uiCell *cdkCellDef="let element" class="flex items-center"></td>
                    </ng-container>
                  </ng-template>
                  <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
                  <tr cdk-row *cdkRowDef="let row; columns: displayedColumns"></tr>
                </table>
              </div>
              <!-- Pagination -->
                <ui-paginator
                [disabled]="emailService.emailListLoading"
                [pageIndex]="pageInfo.pageIndex"
                [pageSize]="pageInfo.pageSize"
                [pageSizeOptions]="[5, 10, 25, 50]"
                [totalItems]="pageInfo.length"
                [ariaLabel]="'components.notifications.paginator.ariaLabel' | translate"
                (pageChange)="onPage($event)"
              >
              </ui-paginator>
          </ng-container>
            <ng-template #emptyTmpl>
              <!-- Empty indicator -->
              <div class="flex flex-col items-center">
              <ui-icon
                [isOutlined]="true"
                [icon]="'folder_open'"
                variant="grey"
                [size]="48"
              ></ui-icon>
              <h3 class="mt-2 text-sm font-semibold text-gray-900">
                {{ 'common.email.notification.none' | translate }}
              </h3>
            </div>
            </ng-template>
          </div>
    
      </ui-tab>
      <!-- Distribution List -->
      <ui-tab>
        <ng-container ngProjectAs="label">{{'components.email.distributionList.list' | translate}}</ng-container>
        <div *ngIf="emailService.isExisting" class="mt-4">
          <div class="mt-4 overflow-x-hidden shadow-2lg">
            <div class="overflow-x-auto">
              <table cdk-table uiTableWrapper [dataSource]="distributionLists">
                <ng-container cdkColumnDef="name">
                  <th uiCellHeader *cdkHeaderCellDef scope="col">
                    <span class="headerTitle">
                      {{ 'common.name' | translate }}
                    </span>
                  </th>
                  <td uiCell *cdkCellDef="let element" class="max-w-[30vw]">
                    {{ element.distributionListName }}
                  </td>
                </ng-container>
                <ng-container cdkColumnDef="createdby">
                  <th uiCellHeader *cdkHeaderCellDef scope="col">
                    <span class="headerTitle">
                      Created By
                    </span>
                  </th>
                  <td uiCell *cdkCellDef="let element" class="max-w-[30vw]">
                    {{ element.createdBy?.name }}
                  </td>
                </ng-container>
                <div *ngIf="this.ability.can('update', 'EmailNotification'); else elseBlock">
                  <ng-container cdkColumnDef="actions" [stickyEnd]="true" >
                    <th uiCellHeader *cdkHeaderCellDef scope="col">
                      <span class="headerTitle">
                       Actions
                      </span>
                    </th>
                    <td uiCell *cdkCellDef="let element" class="flex items-center">
                      <ng-container>
                        <ui-button
                        [variant]="'grey'"
                        class="hide-icons hover:text-primary-600"
                        [isIcon]="true"
                        size="large"
                        [icon]="'edit'"
                        (click)="editDistributionListHandler(element)"
                        [uiTooltip]="'Edit'"
                      >
                    </ui-button>
                    <ui-button
                              [variant]="'danger'"
                              class="hide-icons hover:text-primary-600"
                              [isIcon]="true"
                              size="large"
                              (click)="deleteDistributionList(element)"
                              [icon]="'delete'"
                              [uiTooltip]="'Delete'"
                            >
                          </ui-button>
    
                      </ng-container>
                    </td>
                  </ng-container>
                </div>   
                <ng-template #elseBlock>
                  <ng-container cdkColumnDef="actions" [stickyEnd]="true">
                    <th uiCellHeader *cdkHeaderCellDef scope="col" class="w-16"></th>
                    <td uiCell *cdkCellDef="let element" class="flex items-center"></td>
                  </ng-container>
                </ng-template>             
                <tr cdk-header-row *cdkHeaderRowDef="distributionColumn"></tr>
                <tr cdk-row *cdkRowDef="let row; columns: distributionColumn"></tr>
              </table>
            </div>
          </div>
        
          <!-- Pagination -->
          <ui-paginator
          [disabled]="emailService.emailListLoading"
          [pageIndex]="distributionPageInfo.pageIndex"
          [pageSize]="distributionPageInfo.pageSize"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [totalItems]="distributionPageInfo.length"
          [ariaLabel]="'components.notifications.paginator.ariaLabel' | translate"
          (pageChange)="onDistributionPage($event)"
          >
          </ui-paginator>
        
          </div>
      </ui-tab>

      <!-- Custom Template -->
      <ui-tab>
        <ng-container ngProjectAs="label">Custom Templates</ng-container>
        <div class="mt-4">
          <div class="mt-4 overflow-x-hidden shadow-2lg">
            <ng-container *ngIf="customTemplates?.length;">
              <div class="overflow-x-auto">
                <table cdk-table uiTableWrapper [dataSource]="customTemplates">
                  <ng-container cdkColumnDef="subject">
                    <th uiCellHeader *cdkHeaderCellDef scope="col">
                      <span class="headerTitle">
                        {{ 'common.name' | translate }}
                      </span>
                    </th>
                    <td uiCell *cdkCellDef="let element" class="max-w-[30vw]">
                      {{ element.subject }}
                    </td>
                  </ng-container>
                  <ng-container cdkColumnDef="createdBy">
                    <th uiCellHeader *cdkHeaderCellDef scope="col">
                      <span class="headerTitle">
                        Created By
                      </span>
                    </th>
                    <td uiCell *cdkCellDef="let element" class="max-w-[30vw]">
                      {{ element.createdBy?.name }}
                    </td>
                  </ng-container>
                  <div *ngIf="this.ability.can('update', 'EmailNotification'); else elseBlock">
                    <ng-container cdkColumnDef="actions" [stickyEnd]="true" >
                      <th uiCellHeader *cdkHeaderCellDef scope="col">
                        <span class="headerTitle">
                         Actions
                        </span>
                      </th>
                      <td uiCell *cdkCellDef="let element" class="flex items-center">
                        <ng-container>
                          <ui-button
                          [variant]="'grey'"
                          class="hide-icons hover:text-primary-600"
                          [isIcon]="true"
                          size="large"
                          [icon]="'edit'"
                          [uiTooltip]="'Edit'"
                          (click)="editCustomTemplate(element)"
                        >
                      </ui-button>
                      <ui-button
                                [variant]="'danger'"
                                class="hide-icons hover:text-primary-600"
                                [isIcon]="true"
                                size="large"
                                (click)="deleteCustomTemplate(element)"
                                [icon]="'delete'"
                                [uiTooltip]="'Delete'"
                              >
                            </ui-button>
      
                        </ng-container>
                      </td>
                    </ng-container>
                  </div>
                  <ng-template #elseBlock>
                    <ng-container cdkColumnDef="actions" [stickyEnd]="true">
                      <th uiCellHeader *cdkHeaderCellDef scope="col" class="w-16"></th>
                      <td uiCell *cdkCellDef="let element" class="flex items-center"></td>
                    </ng-container>
                  </ng-template>             
                  <tr cdk-header-row *cdkHeaderRowDef="customTemplateColumns"></tr>
                  <tr cdk-row *cdkRowDef="let row; columns: customTemplateColumns"></tr>
                </table>
              </div>          
          
            <!-- Pagination  -->
            <ui-paginator
            [disabled]="emailService.emailListLoading"
            [pageIndex]="templatePageInfo.pageIndex"
            [pageSize]="templatePageInfo.pageSize"
            [pageSizeOptions]="[5, 10, 25, 50]"
            [totalItems]="templatePageInfo.length"
            [ariaLabel]="'components.notifications.paginator.ariaLabel' | translate"
            (pageChange)="onTemplatePage($event)"
            >
            </ui-paginator>
            </ng-container>
            
        </div>
          </div>
      </ui-tab>
    </ui-tabs>
    <!-- <button
      type="button"
      class="font-semibold mt-2 text-blue-500 py-2 px-4 rounded-md"
      (click)="toggle()"
    >
      or Create New
    </button> -->
  </div>
  <ng-container *ngIf="!emailService.isExisting">
    <div class="relative">
      <ui-button
          [variant]="'danger'"
          class="absolute -top-[22px] -right-[14px] btnClose"
          [isIcon]="true"
          size="large"
          (click)="confirmClose()"
          [icon]="'close'"
          [uiTooltip]="'components.email.back' | translate"
        >
      </ui-button>
    </div>
    <ems-template (navigateToEms)="toggle();getExistingTemplate();" [currentStep]="emailService.stepperStep" class="stepper-center"></ems-template>
  </ng-container>
  </ng-container>
  <div *ngIf="showTemplateCreationWizard">
  <ng-container>
    <div>
      <ui-button
          [variant]="'danger'"
          class="hide-icons hover:text-primary-600 btnClose"
          [isIcon]="true"
          size="large"
          (click)="showTemplateCreationWizard = false"
          [icon]="'close'"
          [uiTooltip]="'components.email.back' | translate"
          (click)="customTemplateClose()"
        >
      </ui-button>
    </div>
    <ems-custom-template (navigateToEms)="showTemplateCreationWizard = false;getExistingTemplate();getCustomTemplates()"></ems-custom-template>
  </ng-container>
  </div>