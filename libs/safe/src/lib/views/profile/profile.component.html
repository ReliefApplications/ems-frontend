<form [formGroup]="userForm" *ngIf="userForm">
  <h1>{{ 'pages.profile.title' | translate }}</h1>
  <!-- User details -->
  <div class="flex flex-col">
    <div class="flex gap-2 flex-wrap">
      <mat-form-field appearance="outline" class="flex-1">
        <mat-label>
          {{ 'models.user.firstName' | translate }}
        </mat-label>
        <input matInput formControlName="firstName" type="text" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="flex-1">
        <mat-label>
          {{ 'models.user.lastName' | translate }}
        </mat-label>
        <input matInput formControlName="lastName" type="text" />
      </mat-form-field>
    </div>
    <mat-form-field appearance="outline">
      <mat-label>
        {{ 'models.user.username' | translate }}
      </mat-label>
      <input matInput formControlName="username" type="text" />
    </mat-form-field>
  </div>
  <ui-button
    [category]="category.SECONDARY"
    [variant]="variant.PRIMARY"
    (click)="onSubmit()"
    [disabled]="userForm.invalid || !userForm.dirty"
  >
    {{ 'common.saveChanges' | translate }}
  </ui-button>
  <!-- Table container -->
  <div class="overflow-x-hidden shadow-2lg mt-6">
    <!-- Table scroll container -->
    <div class="overflow-x-auto">
      <table mat-table [dataSource]="user.applications">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            <span class="headerTitle" mat-sort-header>
              {{ 'common.application.few' | translate }} ({{
                user.applications.length
              }})
            </span>
          </th>
          <td mat-cell *matCellDef="let element" class="font-bold">
            {{ element.name
            }}<span *ngIf="user.favoriteApp === element.id">
              <mat-icon inline="true" color="primary">star</mat-icon>
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>
            <span class="headerTitle" mat-sort-header>
              {{ 'common.role.one' | translate }}
            </span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.role ? element.role.title : '' }}
          </td>
        </ng-container>
        <ng-container matColumnDef="positionAttributes">
          <th mat-header-cell *matHeaderCellDef>
            <span class="headerTitle" mat-sort-header>
              {{ 'common.positionAttribute.few' | translate }}
            </span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span *ngFor="let e of element.positionAttributes"
              >{{ e.value }},
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="actions" [stickyEnd]="true">
          <th mat-header-cell *matHeaderCellDef class="w-16"></th>
          <td mat-cell *matCellDef="let element">
            <ui-button
              [isIcon]="true"
              icon="more_vert"
              [uiMenuTriggerFor]="menu"
              (click)="$event.stopPropagation()"
            >
            </ui-button>
            <ui-menu #menu>
              <button uiMenuItem (click)="onSelectFavorite(element)">
                <mat-icon>star</mat-icon>
                {{ 'models.application.setAsFavorite' | translate }}
              </button>
            </ui-menu>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumnsApps"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsApps"></tr>
      </table>
    </div>
  </div>
</form>
