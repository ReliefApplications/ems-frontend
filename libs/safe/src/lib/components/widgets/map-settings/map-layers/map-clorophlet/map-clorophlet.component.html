<safe-modal [closable]="true" size="fullscreen">
  <form
    mat-dialog-content
    [formGroup]="form"
    class="flex flex-col gap-3 [&:not(td)]:flex [&:not(td)]:flex-col"
  >
    <mat-form-field appearance="outline">
      <mat-label>{{ 'common.name' | translate }}</mat-label>
      <input
        type="text"
        [placeholder]="'common.placeholder.name' | translate"
        matInput
        formControlName="name"
      />
    </mat-form-field>
    <safe-button category="tertiary" (click)="fileInput.click()">{{
      form.value.geoJSONname
        ? form.value.geoJSONname
        : ('common.uploadObject'
          | translate
            : {
                name:
                  ('components.widget.settings.map.layers.clorophlet.geoJSON'
                  | translate)
              })
    }}</safe-button>
    <input
      hidden
      #fileInput
      type="file"
      id="geojson"
      accept=".json, .geojson"
      (change)="uploadGeoJSON()"
    />
    <div class="flex gap-2">
      <mat-form-field appearance="outline">
        <mat-label>{{
          'components.widget.settings.map.layers.clorophlet.identifier'
            | translate
        }}</mat-label>
        <mat-select formControlName="place">
          <mat-option *ngFor="let field of fields" [value]="field">{{
            field
          }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="extraInput">
        <mat-label>{{
          'components.widget.settings.map.layers.clorophlet.geoJSONidentifier'
            | translate
        }}</mat-label>
        <mat-select formControlName="geoJSONfield">
          <mat-option *ngFor="let field of geoJSONfields" [value]="field">{{
            field
          }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <mat-label>Opacity</mat-label>
    <ui-slider
      formControlName="opacity"
      [minValue]="0"
      [maxValue]="100"
    ></ui-slider>
    <!-- LIST of Divisions -->
    <h2 class="mt-6">
      {{
        'components.widget.settings.map.layers.clorophlet.division.title'
          | translate
      }}
    </h2>
    <!-- Table container -->
    <div class="overflow-x-hidden shadow-2lg">
      <!-- Table scroll container -->
      <div class="overflow-x-auto">
        <table mat-table [dataSource]="divisions.value">
          <ng-container matColumnDef="label">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'common.label' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">{{ element.label }}</td>
          </ng-container>
          <ng-container matColumnDef="color">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'common.preview' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <span
                [style]="'background-color:' + element.color"
                class="color-indicator"
              ></span>
            </td>
          </ng-container>
          <ng-container matColumnDef="actions" [stickyEnd]="true">
            <th mat-header-cell *matHeaderCellDef class="w-16"></th>
            <td mat-cell *matCellDef="let element; let i = index">
              <div>
                <safe-button
                  [isIcon]="true"
                  icon="edit"
                  category="primary"
                  (click)="editDivision(i)"
                ></safe-button>
                <safe-button
                  [isIcon]="true"
                  icon="delete"
                  category="primary"
                  variant="danger"
                  (click)="removeDivision(i)"
                ></safe-button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
          <tr *matRowDef="let row; columns: tableColumns" mat-row></tr>
        </table>
      </div>
    </div>
    <safe-button
      class="!w-auto"
      category="tertiary"
      variant="primary"
      (click)="addDivision()"
      >{{
        'components.widget.settings.map.layers.clorophlet.division.add'
          | translate
      }}</safe-button
    >
  </form>
  <div mat-dialog-actions align="end">
    <safe-button mat-dialog-close>
      {{ 'common.close' | translate }}
    </safe-button>
    <safe-button
      category="secondary"
      variant="primary"
      [mat-dialog-close]="form.value"
      [disabled]="form.invalid"
    >
      {{ 'common.update' | translate }}
    </safe-button>
  </div>
</safe-modal>
