<ng-template #layerNavigationTemplate>
  <div class="tabs">
    <safe-button
      icon="map"
      [attr.data-selected]="currentTab === 'parameters'"
      (click)="currentTab = 'parameters'"
    >
      {{ 'components.widget.settings.map.edit.layerProperties' | translate }}
    </safe-button>
    <safe-button
      *ngIf="form?.get('datasource')"
      icon="storage"
      [attr.data-selected]="currentTab === 'datasource'"
      (click)="currentTab = 'datasource'"
    >
      {{ 'components.widget.settings.map.edit.layerDatasource' | translate }}
    </safe-button>
    <safe-button
      *ngIf="form?.get('layerDefinition.drawingInfo')"
      icon="storage"
      [attr.data-selected]="currentTab === 'styling'"
      (click)="currentTab = 'styling'"
      [disabled]="!isDatasourceValid"
    >
      {{ 'components.widget.settings.map.edit.layerStyling' | translate }}
    </safe-button>
    <safe-button
      *ngIf="form?.get('sublayers')"
      icon="map"
      [attr.data-selected]="currentTab === 'sublayers'"
      (click)="currentTab = 'sublayers'"
    >
      {{ 'components.widget.settings.map.edit.groupLayers' | translate }}
    </safe-button>
    <!-- <safe-button
      icon="map"
      [attr.data-selected]="currentTab === 'filter'"
      (click)="currentTab = 'filter'"
    >
      {{ 'components.widget.settings.map.edit.filter' | translate }}
    </safe-button> -->
    <!-- <safe-button
      icon="map"
      [attr.data-selected]="currentTab === 'cluster'"
      (click)="currentTab = 'cluster'"
    >
      {{ 'components.widget.settings.map.edit.cluster.cluster' | translate }}
    </safe-button> -->
    <safe-button
      *ngIf="
        form?.get('layerDefinition.drawingInfo.renderer.type')?.value !==
        'heatmap'
      "
      icon="map"
      [attr.data-selected]="currentTab === 'aggregation'"
      (click)="currentTab = 'aggregation'"
      [disabled]="!isDatasourceValid"
    >
      {{ 'components.widget.settings.map.edit.aggregation' | translate }}
    </safe-button>
    <safe-button
      *ngIf="form?.get('popupInfo')"
      icon="map"
      [attr.data-selected]="currentTab === 'popup'"
      (click)="currentTab = 'popup'"
      [disabled]="!isDatasourceValid"
    >
      {{ 'components.widget.settings.map.edit.popup' | translate }}
    </safe-button>
    <safe-button
      *ngIf="form?.get('datasource')"
      icon="map"
      [attr.data-selected]="currentTab === 'fields'"
      (click)="currentTab = 'fields'"
      [disabled]="!isDatasourceValid"
    >
      {{ 'components.widget.settings.map.edit.fields' | translate }}
    </safe-button>
    <!-- <safe-button
      icon="map"
      [attr.data-selected]="currentTab === 'labels'"
      (click)="currentTab = 'labels'"
    >
      {{ 'components.widget.settings.map.edit.labels' | translate }}
    </safe-button> -->
  </div>
</ng-template>

<ng-template #layerSettingsTemplate>
  <div class="flex flex-col h-full">
    <div class="flex-auto overflow-auto" [ngSwitch]="currentTab">
      <!-- Layer parameters -->
      <ng-container *ngSwitchCase="'parameters'">
        <safe-layer-properties
          [currentZoom]="currentZoom"
          [form]="form"
        ></safe-layer-properties>
      </ng-container>
      <!-- Layer datasource -->
      <ng-container *ngSwitchCase="'datasource'">
        <safe-layer-datasource
          [formGroup]="$any(form.get('datasource'))"
          [resourceQuery]="resource"
          [fields$]="fields$"
          (fields)="fields.next($event)"
        ></safe-layer-datasource>
      </ng-container>
      <ng-container *ngSwitchCase="'sublayers'">
        <safe-map-layers
          [layerIds]="form.get('sublayers')?.value || []"
          (close)="currentTab = null"
          (editLayer)="onEditLayer($event)"
          (deleteLayer)="onDeleteLayer($event)"
        ></safe-map-layers>
      </ng-container>
      <!-- Layer styling -->
      <ng-container *ngSwitchCase="'styling'">
        <safe-layer-styling
          [formGroup]="$any(form.get('layerDefinition.drawingInfo'))"
          [fields$]="fields$"
        ></safe-layer-styling>
      </ng-container>
      <!-- Layer filters -->
      <ng-container *ngSwitchCase="'filter'">
        <safe-layer-filter></safe-layer-filter>
      </ng-container>
      <!-- Layer cluster -->
      <ng-container *ngSwitchCase="'cluster'">
        <safe-layer-cluster></safe-layer-cluster>
      </ng-container>
      <!-- Layer aggregations -->
      <ng-container *ngSwitchCase="'aggregation'">
        <safe-layer-aggregation
          [formGroup]="$any(form.get('layerDefinition.featureReduction'))"
        ></safe-layer-aggregation>
      </ng-container>
      <!-- Layer popup -->
      <ng-container *ngSwitchCase="'popup'">
        <safe-layer-popup
          [formGroup]="$any(form.get('popupInfo'))"
          [fields$]="fields$"
        ></safe-layer-popup>
      </ng-container>
      <!-- Layer fields -->
      <ng-container *ngSwitchCase="'fields'">
        <safe-layer-fields [fields$]="fields$"></safe-layer-fields>
      </ng-container>
      <!-- Layer labels -->
      <ng-container *ngSwitchCase="'labels'">
        <safe-layer-labels></safe-layer-labels>
      </ng-container>
    </div>
    <!-- Layer editor actions-->
    <div class="flex justify-end">
      <safe-button (click)="onCancel()">
        {{ 'common.cancel' | translate }}
      </safe-button>
      <safe-button
        category="secondary"
        variant="primary"
        (click)="onSubmit()"
        cdkFocusInitial
        [disabled]="!form || !form.valid"
      >
        {{ (!layer ? 'common.create' : 'common.update') | translate }}
      </safe-button>
    </div>
  </div>
</ng-template>
