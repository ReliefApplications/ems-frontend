<mat-drawer-container class="grow bg-transparent" autosize *ngIf="tileForm">
  <mat-drawer class="border-none pr-2" mode="side" [opened]="true">
    <safe-button
      icon="map"
      [attr.data-selected]="currentTab === 'parameters'"
      (click)="handleTabChange('parameters')"
    >
      {{ 'components.widget.settings.map.properties.title' | translate }}
    </safe-button>

    <safe-button
      icon="layers"
      [attr.data-selected]="currentTab === 'layers'"
      (click)="handleTabChange('layers')"
    >
      {{ 'common.layers' | translate }}
    </safe-button>
    <safe-button
      icon="settings_overscan"
      [attr.data-selected]="currentTab === 'display'"
      (click)="handleTabChange('display')"
    >
      {{ 'models.widget.display.title' | translate }}
    </safe-button>
    <ng-container *ngIf="currentTab === 'layer' && layerComponent">
      <safe-divider></safe-divider>
      <ng-container
        [ngTemplateOutlet]="layerComponent.layerNavigationTemplate"
      ></ng-container>
    </ng-container>
  </mat-drawer>

  <div class="flex flex-wrap gap-4 flex-col lg:flex-row lg:h-full">
    <ng-container *ngIf="currentTab">
      <div
        [ngClass]="{ 'overflow-auto': currentTab !== 'layer' }"
        [ngSwitch]="currentTab"
        class="lg:basis-1/2 lg:max-h-full px-2"
      >
        <!-- MAP PARAMETERS -->
        <ng-container *ngSwitchCase="'parameters'">
          <safe-map-properties
            [form]="tileForm"
            [mapSettings]="mapSettings"
            (close)="currentTab = null"
          ></safe-map-properties>
        </ng-container>
        <!-- MAP LAYERS -->
        <ng-container *ngSwitchCase="'layers'">
          <safe-map-layers
            [layerIds]="layerIds"
            (close)="currentTab = null"
            (editLayer)="onEditLayer($event)"
            (deleteLayer)="onDeleteLayer($event)"
          ></safe-map-layers>
        </ng-container>
        <ng-container *ngSwitchCase="'layer'">
          <ng-container *ngIf="layerComponent">
            <ng-container
              [ngTemplateOutlet]="layerComponent.layerSettingsTemplate"
            ></ng-container>
          </ng-container>
        </ng-container>
        <ng-container *ngSwitchCase="'display'">
          <safe-display-settings [formGroup]="tileForm"></safe-display-settings>
        </ng-container>
      </div>
    </ng-container>
    <!-- MAP PREVIEW -->
    <div class="lg:flex-1 max-lg:min-w-full h-80 lg:min-h-full flex-shrink-0">
      <safe-map
        class="w-full h-full"
        (mapEvent)="handleMapEvent($event)"
        [mapSettings]="mapSettings"
      ></safe-map>
    </div>
  </div>
</mat-drawer-container>

<ng-container *ngIf="currentTab === 'layer'">
  <safe-map-layer
    [layer]="openedLayers[0]"
    [mapComponent]="mapComponent"
    (layerToSave)="saveLayer($event)"
    (layerToOpen)="onEditLayer($event)"
  ></safe-map-layer>
</ng-container>
