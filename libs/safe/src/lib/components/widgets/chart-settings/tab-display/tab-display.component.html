<form [formGroup]="formGroup">
  <div class="flex flex-col" formGroupName="chart">
    <h2>{{ 'common.display' | translate }}</h2>
    <mat-accordion class="collapsible-form-group">
      <!-- === LEGEND === -->
      <mat-expansion-panel formGroupName="legend">
        <mat-expansion-panel-header>
          <mat-panel-title>{{
            'components.widget.settings.chart.legend' | translate
          }}</mat-panel-title>
        </mat-expansion-panel-header>
        <div>
          <mat-form-field appearance="outline">
            <mat-label>{{
              'components.widget.settings.chart.position' | translate
            }}</mat-label>
            <mat-select formControlName="position">
              <mat-select-trigger>
                {{ chartForm.value.legend.position }}
              </mat-select-trigger>
              <mat-option value="none">{{
                'components.widget.settings.chart.hideLegend' | translate
              }}</mat-option>
              <mat-option
                *ngFor="let position of legendPositions"
                value="{{ position.value }}"
              >
                <div class="flex">
                  <span class="flex w-full items-center justify-between"
                    >{{ position.value }}
                    <safe-icon
                      [inline]="true"
                      icon="{{ position.icon }}"
                    ></safe-icon>
                  </span>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-expansion-panel>
      <!-- === TITLE === -->
      <mat-expansion-panel formGroupName="title">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'common.title' | translate }}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="flex flex-col gap-2">
          <mat-slide-toggle formControlName="visible">{{
            'common.display' | translate
          }}</mat-slide-toggle>
          <ng-container *ngIf="chartForm.value.title.visible">
            <div>
              <mat-form-field appearance="outline">
                <mat-label>{{
                  'components.widget.settings.chart.text' | translate
                }}</mat-label>
                <input matInput formControlName="text" />
              </mat-form-field>
            </div>
            <div>
              <h3>
                {{ 'components.widget.settings.chart.style' | translate }}
              </h3>
              <mat-form-field appearance="outline">
                <mat-label>{{
                  'components.widget.settings.chart.size' | translate
                }}</mat-label>
                <mat-select formControlName="size">
                  <mat-option *ngFor="let size of sizes" [value]="size">
                    {{ size }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <div class="flex gap-2 items-center">
                <safe-button
                  icon="format_bold"
                  (click)="onToggleStyle('title.bold')"
                  [category]="
                    chartForm.get('title.bold')?.value
                      ? 'secondary'
                      : 'tertiary'
                  "
                  [variant]="chartForm.get('title.bold')?.value && 'primary'"
                ></safe-button>
                <safe-button
                  icon="format_italic"
                  (click)="onToggleStyle('title.italic')"
                  [category]="
                    chartForm.get('title.italic')?.value
                      ? 'secondary'
                      : 'tertiary'
                  "
                  [variant]="chartForm.get('title.italic')?.value && 'primary'"
                ></safe-button>
                <safe-button
                  (click)="onToggleStyle('title.underline')"
                  icon="format_underline"
                  [category]="
                    chartForm.get('title.underline')?.value
                      ? 'secondary'
                      : 'tertiary'
                  "
                  [variant]="
                    chartForm.get('title.underline')?.value && 'primary'
                  "
                ></safe-button>
                <div>
                  <kendo-colorpicker
                    formControlName="color"
                  ></kendo-colorpicker>
                </div>
              </div>
            </div>
            <div>
              <h3>
                {{ 'components.widget.settings.chart.position' | translate }}
              </h3>
              <div class="flex gap-0.5">
                <safe-button
                  icon="{{ position.icon }}"
                  category="secondary"
                  [variant]="
                    position.value === chartForm.value.title.position
                      ? 'primary'
                      : ''
                  "
                  (click)="
                    chartForm.patchValue({
                      title: { position: position.value }
                    })
                  "
                  *ngFor="let position of titlePositions"
                >
                </safe-button>
              </div>
            </div>
          </ng-container>
        </div>
      </mat-expansion-panel>
      <!-- === PALETTE -->
      <mat-expansion-panel formGroupName="palette">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'components.widget.settings.chart.palette.title' | translate }}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="flex flex-col gap-2">
          <mat-slide-toggle formControlName="enabled">{{
            'components.widget.settings.chart.palette.enable' | translate
          }}</mat-slide-toggle>
          <safe-palette-control formControlName="value"></safe-palette-control>
        </div>
      </mat-expansion-panel>
      <!-- === LABELS === -->
      <mat-expansion-panel formGroupName="labels">
        <mat-expansion-panel-header>
          <mat-panel-title>{{
            'components.widget.settings.chart.labels.title' | translate
          }}</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="flex flex-col gap-2">
          <mat-slide-toggle
            formControlName="showCategory"
            *ngIf="type.name === 'donut' || type.name === 'pie'"
            >{{
              'components.widget.settings.chart.labels.showCategory' | translate
            }}</mat-slide-toggle
          >
          <div *ngIf="chartForm.value.labels.showCategory">
            <mat-radio-group formControlName="categoryPosition">
              <mat-radio-button value="inside">{{
                'components.widget.settings.chart.labels.inside' | translate
              }}</mat-radio-button>
              <br>
              <mat-radio-button value="outside">{{
                'components.widget.settings.chart.labels.outside' | translate
              }}</mat-radio-button>
            </mat-radio-group>
          </div>
          <mat-slide-toggle formControlName="showValue">{{
            'components.widget.settings.chart.labels.showValue' | translate
          }}</mat-slide-toggle>
          <mat-form-field
            appearance="outline"
            *ngIf="
              chartForm.value.labels.showValue &&
              (['donut', 'pie'].includes(type.name) ||
                (['bar', 'column'].includes(type.name) &&
                  chartForm.value.mapping.series))
            "
          >
            <mat-label>{{
              'components.widget.settings.chart.labels.valueType' | translate
            }}</mat-label>
            <mat-select formControlName="valueType">
              <mat-option value="value">{{
                'common.value.one' | translate
              }}</mat-option>
              <mat-option value="percentage">{{
                'components.widget.settings.chart.labels.percentage' | translate
              }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-expansion-panel>
      <!-- === AXES PARAMETERS === -->
      <mat-expansion-panel
        formGroupName="axes"
        *ngIf="['bar', 'column'].includes(type.name)"
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'components.widget.settings.chart.axes' | translate }}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <!-- === X AXIS PARAMETERS === -->
        <ng-container formGroupName="x" *ngIf="['bar'].includes(type.name)">
          <h3>
            {{ 'components.widget.settings.chart.xAxis' | translate }}
          </h3>
          <div class="axis-container">
            <mat-slide-toggle formControlName="enableMin"></mat-slide-toggle>
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>{{
                'components.aggregationBuilder.operators.min' | translate
              }}</mat-label>
              <input
                matInput
                formControlName="min"
                type="number"
                [placeholder]="'common.auto' | translate"
              />
            </mat-form-field>
          </div>
          <div class="axis-container">
            <mat-slide-toggle formControlName="enableMax"></mat-slide-toggle>
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>{{
                'components.aggregationBuilder.operators.max' | translate
              }}</mat-label>
              <input
                matInput
                formControlName="max"
                type="number"
                [placeholder]="'common.auto' | translate"
              />
            </mat-form-field>
          </div>
        </ng-container>
        <!-- === Y AXIS PARAMETERS === -->
        <ng-container formGroupName="y" *ngIf="['column'].includes(type.name)">
          <h3>
            {{ 'components.widget.settings.chart.yAxis' | translate }}
          </h3>
          <div class="axis-container">
            <mat-slide-toggle formControlName="enableMin"></mat-slide-toggle>
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>{{
                'components.aggregationBuilder.operators.min' | translate
              }}</mat-label>
              <input
                matInput
                formControlName="min"
                type="number"
                [placeholder]="'common.auto' | translate"
              />
            </mat-form-field>
          </div>
          <div class="axis-container">
            <mat-slide-toggle formControlName="enableMax"></mat-slide-toggle>
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>{{
                'components.aggregationBuilder.operators.max' | translate
              }}</mat-label>
              <input
                matInput
                formControlName="max"
                type="number"
                [placeholder]="'common.auto' | translate"
              />
            </mat-form-field>
          </div>
        </ng-container>
      </mat-expansion-panel>
      <!-- === SERIES AND STACKS PARAMETERS === -->
      <mat-expansion-panel
        formGroupName="stack"
        *ngIf="
          ['bar', 'column'].includes(type.name) &&
          chartForm.value.mapping.series
        "
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'components.widget.settings.chart.series.title' | translate }}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="flex flex-col gap-2">
          <mat-slide-toggle formControlName="enable">{{
            'components.widget.settings.chart.series.stack.enable' | translate
          }}</mat-slide-toggle>
          <mat-slide-toggle formControlName="usePercentage">{{
            'components.widget.settings.chart.series.stack.usePercentage'
              | translate
          }}</mat-slide-toggle>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</form>
