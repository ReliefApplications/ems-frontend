<div [formGroup]="formGroup" class="flex flex-col last:mb-0">
  <h2>{{ 'common.general' | translate }}</h2>
  <mat-form-field appearance="outline">
    <mat-label>{{ 'common.title' | translate }}</mat-label>
    <input matInput formControlName="title" type="string" />
  </mat-form-field>
  <ng-container formGroupName="chart">
    <mat-form-field appearance="outline">
      <mat-label>{{
        'components.widget.settings.chart.type' | translate
      }}</mat-label>
      <mat-select formControlName="type">
        <mat-select-trigger>
          <img class="chart-icon" [src]="type.icon" />{{
            type.name | uppercase
          }}
        </mat-select-trigger>
        <mat-option *ngFor="let type of types" [value]="type.name">
          <img class="chart-icon" [src]="type.icon" />
          {{ type.name | uppercase }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </ng-container>
  <mat-form-field appearance="outline">
    <mat-label>{{ 'common.resource.one' | translate }}</mat-label>
    <safe-graphql-select
      valueField="id"
      textField="name"
      [query]="resourcesQuery"
      formControlName="resource"
      [selectedElements]="[resource]"
      (searchChange)="onResourceSearchChange($event)"
      [filterable]="true"
    >
    </safe-graphql-select>
  </mat-form-field>
  <ng-container *ngIf="resource">
    <h2>{{ 'common.aggregation.one' | translate }}</h2>
    <ng-container *ngIf="formGroup.value.chart.aggregationId">
      <mat-form-field appearance="outline" *ngIf="aggregation">
        <mat-label>{{ 'common.aggregation.one' | translate }}</mat-label>
        <mat-select [disabled]="true" [value]="aggregation.id">
          <mat-option [value]="aggregation.id">{{
            aggregation.name
          }}</mat-option>
        </mat-select>
        <safe-button
          matSuffix
          variant="primary"
          [isIcon]="true"
          icon="edit"
          (click)="editAggregation()"
        ></safe-button>
        <safe-button
          matSuffix
          variant="danger"
          [isIcon]="true"
          icon="close"
          (click)="formGroup.get('chart.aggregationId')?.setValue(null)"
        ></safe-button>
      </mat-form-field>
      <h3>{{ 'components.mapping.title' | translate }}</h3>
      <safe-series-mapping
        [availableFields]="availableSeriesFields"
        [formGroup]="$any(formGroup.get('chart.mapping'))"
      ></safe-series-mapping>
    </ng-container>
    <ng-container *ngIf="!formGroup.value.chart.aggregationId">
      <safe-button
        class="!w-auto"
        category="tertiary"
        variant="primary"
        (click)="addAggregation()"
        >{{ 'components.aggregation.add.title' | translate }}</safe-button
      >
    </ng-container>
  </ng-container>
</div>
