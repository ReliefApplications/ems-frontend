<div class="flex flex-col h-full">
  <kendo-tilelayout-item-header *ngIf="header" class="widget-header">
    <span class="widget-title" [title]="settings.title">{{
      settings.title
    }}</span>
    <!-- Switch between grid and cards view -->
    <div class="flex">
      <safe-button
        [isIcon]="true"
        icon="grid_view"
        [disabled]="displayMode === 'cards'"
        (click)="displayMode = 'cards'"
        [matTooltip]="'components.widget.summaryCard.viewAsCards' | translate"
      ></safe-button>
      <safe-button
        [isIcon]="true"
        icon="view_list"
        [disabled]="displayMode === 'grid'"
        (click)="displayMode = 'grid'"
        [matTooltip]="'components.widget.summaryCard.viewAsGrid' | translate"
      ></safe-button>
    </div>
    <safe-button
      *ngIf="export && displayMode === 'cards'"
      [isIcon]="true"
      icon="get_app"
      class="text-neutral-700"
      (click)="pdf.saveAs(exportName)"
    ></safe-button>
  </kendo-tilelayout-item-header>
  <div class="bg-zinc-50 p-2" *ngIf="!!settings.widgetDisplay?.searchable">
    <input
      [placeholder]="'common.placeholder.search' | translate"
      kendoTextBox
      [formControl]="searchControl"
      class="!w-full"
    />
  </div>
  <ng-container *ngIf="displayMode === 'cards'">
    <div class="w-full grow overflow-auto" #summaryCardGrid>
      <kendo-pdf-export #pdf paperSize="A4" margin="2cm">
        <div
          class="summary-card-container k-widget k-tile-layout k-grid-flow-col"
          style.grid-template-columns="{{ 'repeat(' + colsNumber + ', 1fr)' }}"
        >
          <safe-summary-card-item
            *ngFor="let card of cards; let i = index"
            class="k-tilelayout-item k-card"
            [style.order]="i"
            style.grid-column-end="{{
              'span ' +
                (card.width && card.width > colsNumber
                  ? colsNumber
                  : card.width)
            }}"
            style.grid-row-end="{{ 'span ' + card.height }}"
            [card]="card"
          >
          </safe-summary-card-item>
        </div>
      </kendo-pdf-export>
    </div>
  </ng-container>
  <kendo-datapager
    *ngIf="settings.widgetDisplay?.usePagination && displayMode === 'cards'"
    [style.width.%]="100"
    [pageSize]="pageInfo.first"
    [pageSizeValues]="[10, 25, 50, 100]"
    [skip]="pageInfo.skip"
    [total]="pageInfo.totalCount"
    (pageChange)="onPageChange($event)"
  >
  </kendo-datapager>
  <ng-container *ngIf="displayMode === 'grid'">
    <div class="w-full h-full">
      <safe-grid-widget
        class="flex-auto max-h-full w-full"
        [header]="false"
        [settings]="gridSettings"
        [widget]="widget"
      ></safe-grid-widget>
    </div>
  </ng-container>
</div>
