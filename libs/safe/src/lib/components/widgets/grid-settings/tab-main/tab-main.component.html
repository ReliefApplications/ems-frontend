<div [formGroup]="formGroup" class="flex flex-col">
  <h2>{{ 'common.general' | translate }}</h2>
  <!-- Widget title -->
  <div uiFormFieldDirective>
    <label>{{ 'common.title' | translate }}</label>
    <input formControlName="title" type="string" />
  </div>
  <div class="flex gap-2 flex-wrap">
    <!-- Resource selection -->
    <mat-form-field appearance="outline" class="flex-1">
      <mat-label>{{ 'common.resource.one' | translate }}</mat-label>
      <safe-graphql-select
        valueField="id"
        textField="name"
        [query]="resourcesQuery"
        formControlName="resource"
        [selectedElements]="[resource]"
        (searchChange)="onResourceSearchChange($event)"
        [filterable]="true"
      >
      </safe-graphql-select>
      <!-- <mat-label>{{
      'components.queryBuilder.dataset.select' | translate
    }}</mat-label>
    <input
      type="text"
      [placeholder]="'components.queryBuilder.dataset.select' | translate"
      matInput
      formControlName="name"
      [matAutocomplete]="auto"
    />
    <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
      <mat-option *ngFor="let option of queries" [value]="option">
        {{ option }}
      </mat-option>
    </mat-autocomplete> -->
    </mat-form-field>
    <!-- Template selection -->
    <div uiFormFieldDirective class="flex-1">
      <label>{{ 'models.form.template' | translate }}</label>
      <ui-select-menu formControlName="template">
        <ui-select-option>-</ui-select-option>
        <ui-select-option
          *ngFor="let template of templates"
          [value]="template.id"
          [label]="template.name ?? ''"
        >
          {{ template.name }}
        </ui-select-option>
      </ui-select-menu>
      <safe-icon
        uiSuffix
        icon="info_outline"
        variant="grey"
        [uiTooltip]="
          'components.widget.settings.grid.tooltip.template' | translate
        "
      ></safe-icon>
    </div>
  </div>
</div>
<div class="flex flex-col mt-8 gap-8" *ngIf="form || resource">
  <!-- Aggregations -->
  <div *ngIf="!(formGroup.get('layouts')?.value.length > 0)">
    <h2>
      {{ 'components.widget.settings.grid.aggregations.title' | translate }}
    </h2>
    <safe-aggregation-table
      [resource]="resource"
      [selectedAggregations]="$any(formGroup).get('aggregations')"
    ></safe-aggregation-table>
  </div>
  <ui-divider
    *ngIf="
      !(formGroup.get('layouts')?.value.length > 0) &&
      !(formGroup.get('aggregations')?.value.length > 0)
    "
    [text]="'common.or' | translate"
  ></ui-divider>
  <!-- Layouts -->
  <div *ngIf="!(formGroup.get('aggregations')?.value.length > 0)">
    <h2>
      {{ 'components.widget.settings.grid.layouts.title' | translate }}
    </h2>
    <safe-layout-table
      [form]="form"
      [resource]="resource"
      [selectedLayouts]="$any(formGroup).get('layouts')"
    ></safe-layout-table>
  </div>
</div>
