<ng-container *ngIf="tileForm">
  <form [formGroup]="tileForm">
    <div class="form-group">
      <div uiFormFieldDirective>
        <label>{{ 'common.title' | translate }}</label>
        <input formControlName="title" type="string" />
      </div>
    </div>
    <div class="settings">
      <div
        formControlName="isDynamic"
        uiRadioGroupDirective="isDynamicOptions"
        class="flex gap-4 items-center"
      >
        <ui-radio
          [value]="false"
          [checked]="tileForm.get('isDynamic')?.value === false"
        >
          <ng-container ngProjectAs="label">
            {{ 'components.widget.settings.summaryCard.static' | translate }}
          </ng-container>
        </ui-radio>
        <ui-radio
          [value]="true"
          [checked]="tileForm.get('isDynamic')?.value === true"
        >
          <ng-container ngProjectAs="label">
            {{ 'components.widget.settings.summaryCard.dynamic' | translate }}
          </ng-container>
        </ui-radio>
      </div>
      <ui-button
        (click)="addCard()"
        icon="add"
        [disabled]="tileForm.get('isDynamic')?.value && this.cards.length === 1"
        >{{
          'components.widget.settings.summaryCard.add' | translate
        }}</ui-button
      >
    </div>
    <kendo-tilelayout
      [columns]="colsNumber"
      [rowHeight]="200"
      [resizable]="true"
      [reorderable]="!tileForm.value.isDynamic"
      (reorder)="onReorder($event)"
      (resize)="onResize($event)"
    >
      <kendo-tilelayout-item
        *ngFor="let card of cards.controls; let i = index"
        [colSpan]="
          card.value.width > colsNumber ? colsNumber : card.value.width
        "
        [rowSpan]="card.value.height"
      >
        <!-- CARD ITEM -->
        <safe-summary-card-item
          [id]="'card-' + i"
          [card]="card.value"
          [headerTemplate]="cardItemHeader"
        ></safe-summary-card-item>
        <ng-template #cardItemHeader>
          <kendo-tilelayout-item-header class="widget-header">
            <span class="widget-title" [title]="card.value.title">{{
              card.value.title
            }}</span>
            <div class="floating-button">
              <ui-button
                variant="primary"
                icon="open_in_new"
                *ngIf="card.value.showDataSourceLink"
              >
                {{ 'components.widget.summaryCard.dataSource' | translate }}
              </ui-button>
            </div>
          </kendo-tilelayout-item-header>
        </ng-template>
        <ui-button
          icon="more_vert"
          [isIcon]="true"
          class="widget-options"
          [uiMenuTriggerFor]="menu"
        ></ui-button>
        <ui-menu #menu>
          <button uiMenuItem (click)="openCard(i)">
            <ui-icon icon="insert_chart"></ui-icon>
            <span>{{ 'common.settings' | translate }}</span>
          </button>
          <ui-divider></ui-divider>
          <button uiMenuItem (click)="removeCard(i)">
            <ui-icon icon="delete"></ui-icon>
            <span>{{ 'common.delete' | translate }}</span>
          </button>
        </ui-menu>
        <ui-icon
          *ngIf="!tileForm.value.isDynamic"
          icon="drag_indicator"
          class="widget-handle"
        >
        </ui-icon>
      </kendo-tilelayout-item>
    </kendo-tilelayout>
  </form>
</ng-container>
