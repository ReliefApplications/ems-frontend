<div class="form-group" [formGroup]="form">
  <!-- RESOURCE SELECTION  -->
  <div fxFlex uiFormFieldDirective>
    <label>{{ 'models.resource.select' | translate }}</label>
    <ui-graphql-select
      valueField="id"
      textField="name"
      [query]="resourcesQuery"
      formControlName="resource"
      [selectedElements]="[selectedResource]"
      (searchChange)="onResourceSearchChange($event)"
      [filterable]="true"
    ></ui-graphql-select>
  </div>

  <!-- SELECT AGGREGATION OR LAYOUT -->
  <div class="flex flex-col mt-8 gap-8" *ngIf="form.get('resource')?.value">
    <div *ngIf="!selectedAggregation">
      <h2>{{ 'common.layout.one' | translate }}</h2>
    </div>
    <ng-container *ngIf="!selectedLayout && !selectedAggregation">
      <div class="flex justify-center mt-4">
        <ui-button
          class="max-w-xs grow"
          category="tertiary"
          variant="primary"
          (click)="addLayout()"
          >{{
            'components.widget.settings.grid.layouts.add.title' | translate
          }}</ui-button
        >
      </div>
    </ng-container>
    <ui-divider
      *ngIf="!selectedAggregation && !selectedLayout"
      [text]="'common.or' | translate"
    ></ui-divider>
    <div *ngIf="!selectedLayout">
      <h2>{{ 'common.aggregation.one' | translate }}</h2>
    </div>
    <ng-container *ngIf="!selectedLayout && !selectedAggregation">
      <div class="flex justify-center mt-4">
        <ui-button
          class="max-w-xs grow"
          category="tertiary"
          variant="primary"
          (click)="addAggregation()"
          >{{ 'components.aggregation.add.title' | translate }}</ui-button
        >
      </div>
    </ng-container>
  </div>

  <!-- FROM LAYOUTS -->
  <ng-container *ngIf="selectedLayout && form.get('resource')?.value">
    <div uiFormFieldDirective>
      <label>{{ 'common.layout.one' | translate }}</label>
      <ui-select-menu [disabled]="true" [value]="selectedLayout.id">
        <ui-select-option
          [value]="selectedLayout.id"
          [label]="selectedLayout.name ?? ''"
          >{{ selectedLayout.name }}</ui-select-option
        >
      </ui-select-menu>
      <ui-button
        uiSuffix
        variant="primary"
        [isIcon]="true"
        icon="edit"
        (click)="editLayout()"
      ></ui-button>
      <ui-button
        uiSuffix
        variant="danger"
        [isIcon]="true"
        icon="close"
        (click)="
          form.get('layout')?.setValue(null);
          form.patchValue({ isAggregation: true })
        "
      ></ui-button>
    </div>
    <h2>
      {{
        'components.widget.settings.summaryCard.card.dataSource.layoutStyles.title'
          | translate
      }}
    </h2>
    <ui-checkbox formControlName="useStyles">
      <ng-container ngProjectAs="label">
        {{
          'components.widget.settings.summaryCard.card.dataSource.layoutStyles.use'
            | translate
        }}
      </ng-container>
    </ui-checkbox>
    <div *ngIf="this.form.value.useStyles">
      <p>
        {{
          'components.widget.settings.summaryCard.card.dataSource.layoutStyles.wholeRow.title'
            | translate
        }}
      </p>
      <div
        class="flex gap-12 items-center my-4"
        formControlName="wholeCardStyles"
        uiRadioGroupDirective="wholeCardStylesOptions"
      >
        <ui-radio
          [value]="false"
          [checked]="form.get('wholeCardStyles')?.value === false"
        >
          <ng-container ngProjectAs="label">
            {{
              'components.widget.settings.summaryCard.card.dataSource.layoutStyles.wholeRow.option1'
                | translate
            }}
          </ng-container>
        </ui-radio>
        <ui-radio
          [value]="true"
          [checked]="form.get('wholeCardStyles')?.value === true"
        >
          <ng-container ngProjectAs="label">
            {{
              'components.widget.settings.summaryCard.card.dataSource.layoutStyles.wholeRow.option2'
                | translate
            }}
          </ng-container>
        </ui-radio>
      </div>
    </div>
  </ng-container>
  <!-- FROM AGGREGATIONS -->
  <ng-container *ngIf="selectedAggregation && form.get('resource')?.value">
    <div uiFormFieldDirective>
      <label>{{ 'common.aggregation.one' | translate }}</label>
      <ui-select-menu [disabled]="true" [value]="selectedAggregation.id">
        <ui-select-option
          [value]="selectedAggregation.id"
          [label]="selectedAggregation.name ?? ''"
          >{{ selectedAggregation.name }}</ui-select-option
        >
      </ui-select-menu>
      <ui-button
        uiSuffix
        variant="primary"
        [isIcon]="true"
        icon="edit"
        (click)="editAggregation()"
      ></ui-button>
      <ui-button
        uiSuffix
        variant="danger"
        [isIcon]="true"
        icon="close"
        (click)="form.get('aggregation')?.setValue(null)"
      ></ui-button>
    </div>
  </ng-container>
</div>
