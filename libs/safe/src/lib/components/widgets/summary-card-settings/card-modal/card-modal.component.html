<safe-modal [closable]="true" size="fullscreen">
  <h1 mat-dialog-title>
    {{ 'components.widget.settings.summaryCard.card.title' | translate }}
  </h1>
  <mat-dialog-content>
    <form [formGroup]="form">
      <ui-tabs
        [vertical]="true"
        #tabGroup
        (selectedIndexChange)="handleTabChange($event)"
        [selectedIndex]="0"
      >
        <!-- Selection of data source -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <safe-icon icon="settings" [size]="24"></safe-icon>
            <span>{{
              'components.widget.settings.summaryCard.card.dataSource.title'
                | translate
            }}</span>
          </ng-container>
          <safe-data-source-tab
            [form]="form"
            [selectedResource]="selectedResource"
            [selectedLayout]="selectedLayout"
            [selectedAggregation]="selectedAggregation"
            (layoutChange)="handleLayoutChange($event)"
            (aggregationChange)="handleAggregationChange($event)"
          ></safe-data-source-tab>
        </ui-tab>
        <!-- Selection of record -->
        <ui-tab
          *ngIf="
            !form.get('isDynamic')?.value && !form.get('isAggregation')?.value
          "
        >
          <ng-container ngProjectAs="label">
            <safe-icon icon="list" [size]="24"></safe-icon>
            <span>{{
              'components.widget.settings.summaryCard.card.valueSelector.title'
                | translate
            }}</span>
          </ng-container>
          <safe-value-selector-tab
            [form]="form"
            [settings]="selectedLayout"
          ></safe-value-selector-tab>
        </ui-tab>
        <!-- Card display settings -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <safe-icon icon="display_settings" [size]="24"></safe-icon>
            <span>{{ 'common.display' | translate }}</span>
          </ng-container>
          <safe-display-tab [form]="form"></safe-display-tab>
        </ui-tab>
        <!-- Card text editor -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <safe-icon icon="article" [size]="24"></safe-icon>
            <span>{{
              'components.widget.settings.summaryCard.card.textEditor.title'
                | translate
            }}</span>
          </ng-container>
          <safe-text-editor-tab
            *ngIf="isEditorTab()"
            [form]="form"
            [fields]="fields"
          ></safe-text-editor-tab>
        </ui-tab>
        <!-- Preview of card -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <safe-icon icon="preview" [size]="24"></safe-icon>
            <span>{{ 'common.preview' | translate }}</span>
          </ng-container>
          <safe-preview-tab
            [form]="form"
            [record]="selectedRecord"
            [fields]="fields"
            [layout]="form.value.isAggregation ? null : selectedLayout"
          ></safe-preview-tab>
        </ui-tab>
      </ui-tabs>
    </form>
  </mat-dialog-content>
  <!-- Modal actions ( close / save ) -->
  <div mat-dialog-actions class="mat-dialog-actions" align="end">
    <safe-button mat-dialog-close>
      {{ 'common.close' | translate }}
    </safe-button>
    <safe-button
      category="secondary"
      variant="primary"
      (click)="onSubmit()"
      cdkFocusInitial
      [disabled]="!form || !form.valid"
    >
      {{ 'common.save' | translate }}
    </safe-button>
  </div>
</safe-modal>
