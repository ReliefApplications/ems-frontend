<ui-dialog [closable]="true" size="fullscreen">
  <ng-container ngProjectAs="header">
    <h1>
      {{ 'components.widget.settings.summaryCard.card.title' | translate }}
    </h1>
  </ng-container>
  <ng-container ngProjectAs="content">
    <form [formGroup]="form">
      <ui-tabs
        [vertical]="true"
        #tabGroup
        (selectedIndexChange)="handleTabChange($event)"
        [selectedIndex]="0"
      >
        <!-- Selection of data source -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <ui-icon icon="settings" [size]="24"></ui-icon>
            <span>{{
              'components.widget.settings.summaryCard.card.dataSource.title'
                | translate
            }}</span>
          </ng-container>
          <safe-data-source-tab
            [form]="form"
            [selectedResource]="selectedResource"
            [selectedLayout]="selectedLayout"
            [selectedAggregation]="selectedAggregation"
            (layoutChange)="handleLayoutChange($event)"
            (aggregationChange)="handleAggregationChange($event)"
          ></safe-data-source-tab>
        </ui-tab>
        <!-- Selection of record -->
        <ui-tab
          *ngIf="
            !form.get('isDynamic')?.value && !form.get('isAggregation')?.value
          "
        >
          <ng-container ngProjectAs="label">
            <ui-icon icon="list" [size]="24"></ui-icon>
            <span>{{
              'components.widget.settings.summaryCard.card.valueSelector.title'
                | translate
            }}</span>
          </ng-container>
          <safe-value-selector-tab
            [form]="form"
            [settings]="selectedLayout"
          ></safe-value-selector-tab>
        </ui-tab>
        <!-- Card display settings -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <ui-icon icon="display_settings" [size]="24"></ui-icon>
            <span>{{ 'common.display' | translate }}</span>
          </ng-container>
          <safe-display-tab [form]="form"></safe-display-tab>
        </ui-tab>
        <!-- Card text editor -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <ui-icon icon="article" [size]="24"></ui-icon>
            <span>{{
              'components.widget.settings.summaryCard.card.textEditor.title'
                | translate
            }}</span>
          </ng-container>
          <safe-text-editor-tab
            *ngIf="isEditorTab()"
            [form]="form"
            [fields]="fields"
          ></safe-text-editor-tab>
        </ui-tab>
        <!-- Preview of card -->
        <ui-tab>
          <ng-container ngProjectAs="label">
            <ui-icon icon="preview" [size]="24"></ui-icon>
            <span>{{ 'common.preview' | translate }}</span>
          </ng-container>
          <safe-preview-tab
            [form]="form"
            [record]="selectedRecord"
            [fields]="fields"
            [layout]="form.value.isAggregation ? null : selectedLayout"
          ></safe-preview-tab>
        </ui-tab>
      </ui-tabs>
    </form>
  </ng-container>
  <ng-container ngProjectAs="actions">
    <!-- Modal actions ( close / save ) -->
      <ui-button uiDialogClose>
        {{ 'common.close' | translate }}
      </ui-button>
      <ui-button
        category="secondary"
        variant="primary"
        (click)="onSubmit()"
        cdkFocusInitial
        [disabled]="!form || !form.valid"
      >
        {{ 'common.save' | translate }}
      </ui-button>
  </ng-container>
</ui-dialog>
