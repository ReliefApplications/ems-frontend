<ui-select-menu
  [formControl]="ngControl && $any(ngControl.control)"
  (openedChange)="onOpenSelect($event)"
  (closed)="onCloseSelect()"
  [required]="required"
  (focusin)="onFocusIn()"
  (focusout)="onFocusOut($event)"
>
  <!-- Search -->
  <ng-container *ngIf="filterable">
    <ng-container *ngTemplateOutlet="search"></ng-container>
  </ng-container>
  <!-- Regular options -->
  <ui-select-option
    *ngFor="let element of elements$ | async"
    [value]="element[valueField]"
    [label]="getDisplayValue(element)"
  >
    {{ getDisplayValue(element) }}
  </ui-select-option>
  <ui-spinner [size]="'medium'" *ngIf="loading" class="my-2"></ui-spinner>
</ui-select-menu>
<!-- Search template -->
<ng-template #search>
  <ui-select-option class="!sticky top-0 !h-auto z-10 !bg-white !p-0">
    <div uiFormFieldDirective class="!w-full -mb-5">
      <label>{{ 'common.placeholder.search' | translate }}</label>
      <input [formControl]="searchControl" type="text" />
      <ui-button
        uiSuffix
        [isIcon]="true"
        icon="close"
        (click)="searchControl.setValue('')"
      ></ui-button>
    </div>
  </ui-select-option>
</ng-template>
