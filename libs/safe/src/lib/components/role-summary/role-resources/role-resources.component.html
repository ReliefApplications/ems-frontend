<!-- Filtering -->
<safe-role-resources-filter
  class="block mb-8"
  (filter)="onFilter($event)"
  [loading]="filterLoading"
></safe-role-resources-filter>
<!-- Resource Table -->
<!-- Table container -->
<div class="overflow-x-hidden shadow-2lg">
  <!-- Table scroll container -->
  <div class="overflow-x-auto">
    <table
      *ngIf="!loading"
      mat-table
      [dataSource]="resources"
      multiTemplateDataRows
    >
      <!-- Resource Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'common.name' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" class="font-bold">
          {{ element.resource.name }}
        </td>
      </ng-container>
      <!-- Resource Actions & Permissions -->
      <ng-container matColumnDef="actions" [stickyEnd]="true">
        <th mat-header-cell *matHeaderCellDef class="w-16"></th>
        <td mat-cell *matCellDef="let element">
          <div class="flex">
            <!-- Permissions -->
            <ng-container *ngFor="let permission of element.permissions">
              <safe-button
                [isIcon]="true"
                [icon]="permission.icon"
                [variant]="permission.variant"
                (click)="editResourceAccess(element.resource, permission.name)"
                [disabled]="loading || updating"
                [matTooltip]="
                  permission.tooltip
                    | translate : { resource: element.resource.name }
                "
                matTooltipPosition="left"
              >
              </safe-button>
            </ng-container>
            <!-- Open Resource -->
            <safe-button
              [isIcon]="true"
              [icon]="
                element.resource.id === openedResource?.id
                  ? 'keyboard_arrow_up'
                  : 'keyboard_arrow_down'
              "
              (click)="toggleResource(element.resource)"
              [disabled]="loading || updating"
            >
            </safe-button>
          </div>
        </td>
      </ng-container>
      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="displayedColumns.length"
        >
          <div
            class="expanded-form"
            [@detailExpand]="
              element.resource.id === openedResource?.id
                ? 'expanded'
                : 'collapsed'
            "
          >
            <ng-container
              *ngIf="
                openedResource && element.resource.id === openedResource?.id
              "
            >
              <safe-resource-access-filters
                [disabled]="loading || updating"
                [role]="role.id!"
                [resource]="openedResource"
                (update)="editResourceAccessFilter(element.resource, $event)"
              >
              </safe-resource-access-filters>
              <safe-resource-fields
                [disabled]="loading || updating"
                [role]="role"
                [resource]="openedResource"
                (onToggle)="
                  onEditFieldAccess(
                    $event.resource,
                    $event.field,
                    $event.permission
                  )
                "
              ></safe-resource-fields>
            </ng-container>
          </div>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="h-0"
      ></tr>
    </table>
    <safe-skeleton-table
      class="my-4 mx-0 w-full"
      *ngIf="loading"
      [columns]="['common.name']"
    >
    </safe-skeleton-table>
  </div>
  <mat-paginator
    [disabled]="loading || updating"
    [pageIndex]="pageInfo.pageIndex"
    [pageSize]="pageInfo.pageSize"
    [pageSizeOptions]="[10, 25, 50]"
    [length]="pageInfo.length"
    [ariaLabel]="'components.resource.paginator.ariaLabel' | translate"
    (page)="onPage($event)"
  >
  </mat-paginator>
</div>
