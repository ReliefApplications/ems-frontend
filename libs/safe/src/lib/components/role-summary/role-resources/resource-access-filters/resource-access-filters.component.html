<!-- Header -->
<h2>{{ 'common.filter.few' | translate }}</h2>
<!-- Content -->
<div *ngIf="filters.data.length === 0" class="flex flex-col p-4 items-center">
  <safe-icon icon="folder_open"></safe-icon>
  <h3>{{ 'components.role.summary.noFilters' | translate }}</h3>
</div>
<!-- Table container -->
<div class="overflow-x-hidden shadow-2lg">
  <!-- Table scroll container -->
  <div class="overflow-x-auto">
    <table
      cdk-table
      uiTableWrapper
      [dataSource]="filters"
      *ngIf="filters.data.length > 0"
      multiTemplateDataRows
    >
      <ng-container cdkColumnDef="filter">
        <th cdk-header-cell *cdkHeaderCellDef scope="col">
          {{ 'components.queryBuilder.filter.title' | translate }}
        </th>
        <td cdk-cell *cdkCellDef="let element">
          {{ getAccessString(element.access) }}
        </td>
      </ng-container>
      <ng-container cdkColumnDef="actions" [stickyEnd]="true">
        <th cdk-header-cell *cdkHeaderCellDef scope="col" class="text-end w-16">
          <safe-button
            [disabled]="disabled"
            variant="primary"
            category="tertiary"
            (click)="save()"
            >{{ 'common.save' | translate }}</safe-button
          >
        </th>
        <td cdk-cell *cdkCellDef="let element; let i = dataIndex">
          <div class="flex">
            <ng-container *ngFor="let permission of element.permissions">
              <safe-button
                [disabled]="disabled"
                *ngIf="permission.name !== 'canCreateRecords'"
                [isIcon]="true"
                [icon]="permission.icon"
                [variant]="permission.variant"
                [uiTooltip]="permission.tooltip | translate"
                (click)="
                  $event.stopPropagation();
                  toggleFilterAccess(i, permission.name)
                "
              >
              </safe-button>
            </ng-container>
          </div>
        </td>
      </ng-container>
      <ng-container cdkColumnDef="expandedDetail">
        <td
          cdk-cell
          *cdkCellDef="let element; let i = dataIndex"
          [attr.colspan]="displayedColumns.length"
        >
          <div
            [ngClass]="{
              'expanded-filter': i === openedFilterIndex
            }"
            [@detailExpand]="i === openedFilterIndex ? 'expanded' : 'collapsed'"
          >
            <safe-filter
              *ngIf="i === openedFilterIndex"
              [form]="openedFilterFormGroup!"
              [fields]="filterFields"
            >
            </safe-filter>
            <safe-button
              *ngIf="i === openedFilterIndex"
              [disabled]="disabled"
              variant="danger"
              category="secondary"
              icon="delete"
              (click)="deleteFilter(i)"
              class="w-fit"
            >
              {{ 'components.role.summary.removeFilter' | translate }}
            </safe-button>
          </div>
        </td>
      </ng-container>

      <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
      <tr
        *cdkRowDef="let row; columns: displayedColumns; let i = dataIndex"
        cdk-row
        (click)="toggleFilterEdition(i)"
        class="cursor-pointer"
      ></tr>
      <tr
        cdk-row
        *cdkRowDef="let row; columns: ['expandedDetail']"
        class="cursor-pointer h-0"
      ></tr>
    </table>
  </div>
</div>
<safe-button
  [disabled]="disabled"
  variant="primary"
  category="secondary"
  (click)="addFilter()"
  class="self-center"
>
  {{ 'components.role.summary.addFilter' | translate }}
</safe-button>
