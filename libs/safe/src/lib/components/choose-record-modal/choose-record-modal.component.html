<ui-dialog size="medium" [closable]="true">
  <ng-container ngProjectAs="header">
    <h1>
      {{
        'components.record.attach.selectTarget'
          | translate : { name: data.targetForm.name }
      }}
    </h1>
  </ng-container>
  <ng-container ngProjectAs="content">
    <form [formGroup]="chooseRecordForm" *ngIf="!isSearchActivated">
      <div class="flex flex-col">
        <div uiFormFieldDirective>
          <label>{{ 'common.record.one' | translate }}</label>
          <ui-graphql-select
            *ngIf="dataQuery"
            [query]="dataQuery"
            formControlName="record"
            valueField="id"
            [textField]="this.data.targetFormField"
            (searchChange)="onSearchChange($event)"
            [filterable]="true"
          >
          </ui-graphql-select>
        </div>
      </div>
    </form>
    <safe-core-grid
      *ngIf="isSearchActivated"
      [settings]="settings"
      [multiSelect]="false"
      [selectedRows]="
        chooseRecordForm.value.record ? [chooseRecordForm.value.record] : []
      "
      (selectionChange)="onSelectionChange($event)"
      class="h-96"
    >
    </safe-core-grid>
  </ng-container>
  <ng-container ngProjectAs="actions">
    <ui-button
      category="secondary"
      cdkFocusInitial
      (click)="isSearchActivated = !isSearchActivated"
      *ngIf="data.targetFormQuery"
    >
      {{ (isSearchActivated ? 'common.select' : 'common.search') | translate }}
    </ui-button>
    <ui-button (click)="onClose()">{{ 'common.cancel' | translate }}</ui-button>
    <ui-button
      category="secondary"
      variant="primary"
      [uiDialogClose]="chooseRecordForm.value"
      cdkFocusInitial
      [disabled]="!chooseRecordForm.valid"
    >
      {{ 'components.record.attach.confirm' | translate }}
    </ui-button>
  </ng-container>
</ui-dialog>
