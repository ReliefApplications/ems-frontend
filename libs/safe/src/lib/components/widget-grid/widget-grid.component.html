<div *ngIf="!loading">
  <!-- NEW WIDGETS -->
  <div
    class="widget-choice-wrapper"
    *ngIf="canUpdate"
    [ngClass]="{ 'floating-widget-choice-wrapper': widgets.length > 0 }"
  >
    <h2 *ngIf="widgets.length === 0">{{ 'models.widget.add' | translate }}</h2>
    <safe-widget-choice
      [floating]="widgets.length > 0"
      [widgetTypes]="availableWidgets"
      (add)="onAdd($event)"
    >
    </safe-widget-choice>
  </div>
  <!-- GRID OF WIDGETS -->
  <!-- <div cdkDropList class="grid grid-cols-[repeat(${colsNumber}, minmax(0, 1fr))] -m-4" (cdkDropListDropped)="drop($event)"> -->
  <div
    cdkDropListGroup
    class="grid -m-4"
    [ngStyle]="{
      'grid-template-columns': colsNumberString,
      'grid-template-rows': '200px'
    }"
  >
    <!-- [columns]="colsNumber"
    [rowHeight]="200"
    [resizable]="canUpdate"
    [reorderable]="canUpdate"
    (reorder)="onReorder($event)"
    (resize)="onResize($event)" -->
    <div
      cdkDropList
      class="h-full"
      [ngStyle]="{
        'grid-column': 'span ' + colsNumber / 4
      }"
      (cdkDropListDropped)="drop($event)"
      [id]="'0'"
      [cdkDropListConnectedTo]="colsNumberConnections"
      [cdkDropListData]="widgets"
    >
      <div
        cdkDrag
        *ngFor="let widget of widgets; let i = index"
        [class.shadow-2lg]="widget.settings.widgetDisplay?.showBorder ?? true"
        [class.hide-border]="
          !(widget.settings.widgetDisplay?.showBorder ?? true)
        "
        [class.hover:shadow-2lg]="isBackOffice"
        [class.bg-inherit]="
          !(widget.settings.widgetDisplay?.showBorder ?? true)
        "
        [ngStyle]="{
          'grid-column':
            'span ' +
            (widget.defaultCols > colsNumber ||
            (!canUpdate && widgets.length === 1)
              ? colsNumber
              : widget.defaultCols),
          'grid-row':
            'span ' +
            (!canUpdate && widgets.length === 1 ? 4 : widget.defaultRows)
        }"
      >
        <safe-floating-options
          *ngIf="canUpdate"
          class="widget-options"
          [widget]="widget"
          (edit)="onEditWidget($event)"
          (delete)="onDeleteWidget($event)"
          (expand)="onExpandWidget($event)"
        >
        </safe-floating-options>
        <safe-widget
          [widget]="widget"
          (goToNextStep)="goToNextStep.emit($event)"
          [id]="'widget-' + widget.id"
          (edit)="onEditWidget($event)"
          [canUpdate]="canUpdate"
        ></safe-widget>
        <safe-icon
          *ngIf="canUpdate"
          icon="drag_indicator"
          class="widget-handle"
        >
        </safe-icon>
        <safe-button
          *ngIf="!canUpdate"
          [isIcon]="true"
          icon="open_in_full"
          class="widget-expand"
          (click)="onExpandWidget(widget)"
        >
        </safe-button>
      </div>
    </div>
    <div
      cdkDropList
      class="h-full"
      [ngStyle]="{
        'grid-column': 'span ' + colsNumber / 4
      }"
      *ngFor="let c of colsNumberTable, let i = index"
      (cdkDropListDropped)="drop($event)"
      [id]="c"
      [cdkDropListConnectedTo]="colsNumberConnections"
      [cdkDropListData]="sampleList[i]"
    >
      <div
        cdkDrag
        *ngFor="let widget of sampleList[i]"
        [class.shadow-2lg]="widget.settings.widgetDisplay?.showBorder ?? true"
        [class.hide-border]="
          !(widget.settings.widgetDisplay?.showBorder ?? true)
        "
        [class.hover:shadow-2lg]="isBackOffice"
        [class.bg-inherit]="
          !(widget.settings.widgetDisplay?.showBorder ?? true)
        "
        [ngStyle]="{
          'grid-column':
            'span ' +
            (widget.defaultCols > colsNumber ||
            (!canUpdate && widgets.length === 1)
              ? colsNumber
              : widget.defaultCols),
          'grid-row':
            'span ' +
            (!canUpdate && widgets.length === 1 ? 4 : widget.defaultRows)
        }"
      >
        <safe-floating-options
          *ngIf="canUpdate"
          class="widget-options"
          [widget]="widget"
          (edit)="onEditWidget($event)"
          (delete)="onDeleteWidget($event)"
          (expand)="onExpandWidget($event)"
        >
        </safe-floating-options>
        <safe-widget
          [widget]="widget"
          (goToNextStep)="goToNextStep.emit($event)"
          [id]="'widget-' + widget.id"
          (edit)="onEditWidget($event)"
          [canUpdate]="canUpdate"
        ></safe-widget>
        <safe-icon
          *ngIf="canUpdate"
          icon="drag_indicator"
          class="widget-handle"
        >
        </safe-icon>
        <safe-button
          *ngIf="!canUpdate"
          [isIcon]="true"
          icon="open_in_full"
          class="widget-expand"
          (click)="onExpandWidget(widget)"
        >
        </safe-button>
      </div>
    </div>
  </div>
</div>
<!-- LOADING INDICATOR -->
<div *ngIf="loading" class="mt-6">
  <div
    class="grid -m-4"
    [ngStyle]="{
      'grid-template-columns': colsNumberString,
      'grid-template-rows': '200px'
    }"
    class="-m-4"
  >
    <div
      *ngFor="let skeleton of skeletons"
      [ngStyle]="{
        'grid-column': 'span ' + skeleton.colSpan,
        'grid-row': 'span ' + skeleton.rowSpan
      }"
    >
      <kendo-skeleton
        shape="rectangle"
        animation="pulse"
        [width]="'100%'"
        [height]="'100%'"
      ></kendo-skeleton>
    </div>
  </div>
</div>
