<ng-container *ngIf="!loading; else loadingTmpl">
  <ng-container *ngIf="roles?.data?.length">
    <div class="flex gap-8 justify-between flex-col sm:flex-row">
      <!-- Filters -->
      <div class="flex flex-col gap-4">
        <!-- Default filter -->
        <div class="flex flex-wrap gap-2 sm:items-center flex-col sm:flex-row">
          <!-- Search text filter -->
          <mat-form-field appearance="outline" class="mat-form-field-sm p-0">
            <mat-icon matPrefix>search</mat-icon>
            <mat-label>{{ 'common.placeholder.search' | translate }}</mat-label>
            <input
              matInput
              [ngModel]="searchText"
              (keyup)="applyFilter('', $event)"
              type="search"
            />
          </mat-form-field>
        </div>
      </div>
      <div class="flex items-center">
        <ng-container *ngTemplateOutlet="newRole"></ng-container>
      </div>
    </div>
  </ng-container>
  <!-- Actions -->
  <ng-template #newRole>
    <ui-button
      *ngIf="'create' | able : 'Role'"
      icon="add"
      category="secondary"
      variant="primary"
      (click)="onAdd()"
    >
      {{ 'models.role.create' | translate }}
    </ui-button>
  </ng-template>
  <ng-container *ngIf="roles?.data?.length; else emptyTmpl">
    <!-- Table container -->
    <div class="mt-4 overflow-x-hidden shadow-2lg">
      <!-- Table scroll container -->
      <div class="overflow-x-auto">
        <table cdk-table uiTableWrapper [dataSource]="roles">
          <ng-container cdkColumnDef="title">
            <th uiCellHeader *cdkHeaderCellDef scope="col">
              <span class="headerTitle">
                {{ 'common.title' | translate }}
              </span>
            </th>
            <td uiCell *cdkCellDef="let element" class="font-bold">
              {{ element.title }}
            </td>
          </ng-container>

          <ng-container cdkColumnDef="usersCount">
            <th uiCellHeader *cdkHeaderCellDef scope="col">
              <span class="headerTitle">
                {{ 'common.user.few' | translate }}
              </span>
            </th>
            <td uiCell *cdkCellDef="let element">
              {{ element.users?.totalCount }}
            </td>
          </ng-container>

          <ng-container cdkColumnDef="actions" [stickyEnd]="true">
            <th uiCellHeader *cdkHeaderCellDef scope="col" class="w-16"></th>
            <td uiCell *cdkCellDef="let element">
              <ui-button
                [isIcon]="true"
                icon="more_vert"
                [uiMenuTriggerFor]="menu"
                (click)="$event.stopPropagation()"
              >
              </ui-button>
              <ui-menu #menu>
                <!-- <button uiMenuItem (click)="onOpen(element)">
              <mat-icon>edit</mat-icon>
              {{ 'common.edit' | translate }}
            </button>
            <ui-divider class="m-0"></ui-divider> -->
                <button uiMenuItem color="warn" (click)="onDelete(element)">
                  <mat-icon>delete</mat-icon>
                  {{ 'common.delete' | translate }}
                </button>
              </ui-menu>
            </td>
          </ng-container>

          <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
          <tr
            cdk-row
            *cdkRowDef="let row; columns: displayedColumns"
            (click)="onOpen(row)"
            class="cursor-pointer"
          ></tr>
        </table>
      </div>
    </div>
  </ng-container>
  <ng-template #emptyTmpl>
    <!-- Empty indicator -->
    <safe-empty
      [title]="'common.role.none' | translate"
      [footerTemplate]="newRole"
    ></safe-empty>
  </ng-template>
</ng-container>
<ng-template #loadingTmpl>
  <safe-skeleton-table
    [columns]="['common.title', 'common.user.few']"
    [actions]="true"
  >
  </safe-skeleton-table>
</ng-template>
