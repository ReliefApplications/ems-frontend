<div class="border-2 border-opacity-20 border-black rounded-md bg-white">
  <!-- Small control ( not showing legend ) -->
  <button class="bg-none p2" (click)="toggleVisibility()" *ngIf="!expanded">
    <ui-icon icon="list"></ui-icon>
  </button>
  <!-- Expanded control ( showing legend ) -->
  <div class="flex flex-col w-48" *ngIf="expanded">
    <!-- Header -->
    <div
      class="flex px-2 py-1 justify-between items-center border-opacity-20 border-b-2"
    >
      <h2 class="m-0">
        {{ 'components.widget.settings.map.legend.title' | translate }}
      </h2>
      <ui-button
        icon="close"
        [isIcon]="true"
        (click)="toggleVisibility()"
      ></ui-button>
    </div>
    <!-- Layers -->
    <div class="max-h-80 overflow-y-auto p-2 flex flex-col gap-2">
      <div *ngFor="let layerLegend of layerLegends" class="mb-2">
        <h3 class="font-black mb-1">{{ layerLegend.layer }}</h3>
        <div [innerHtml]="layerLegend.legend"></div>
        <!-- <div
          *ngIf="layerLegend.legend.type === 'feature'"
          class="flex flex-col gap-1"
        >
          <div
            *ngFor="let item of layerLegend.legend.items"
            class="flex gap-3 items-center"
          >
            <i
              *ngIf="item.icon && item.icon !== 'leaflet_default'"
              [style.color]="item.color"
              class="{{ item.icon | safeIconDisplay : 'fa' }}"
            ></i>
            <div
              *ngIf="!item.icon || item.icon === 'leaflet_default'"
              class="w-6 h-6 rounded-sm"
              [ngStyle]="{ 'background-color': item.color }"
            ></div>
            <span>{{ item.label }}</span>
          </div>
        </div>
        <div
          *ngIf="layerLegend.legend.type === 'cluster'"
          class="flex flex-col gap-1"
        >
          <div class="grid grid-cols-2 w-fit gap-2 items-center">
            <ng-container *ngFor="let size of [30, 60, 80]; let i = index">
              <div class="w-full h-full flex items-center justify-center">
                <i
                  *ngIf="
                    layerLegend.legend.icon &&
                    layerLegend.legend.icon !== 'leaflet_default'
                  "
                  [style.color]="layerLegend.legend.color"
                  [style.fontSize.px]="size"
                  class="{{ layerLegend.legend.icon | safeIconDisplay : 'fa' }}"
                ></i>
              </div>

              <span class="ml-2">
                {{ i === 0 ? '≤' : i === 1 ? '' : '≥' }} {{ size }}</span
              >
            </ng-container>
          </div>
        </div>
        <div *ngIf="layerLegend.legend.type === 'heatmap'" class="flex gap-1">
          <div
            class="h-40 w-8"
            [ngStyle]="{
              background: getCssGradient(layerLegend.legend.gradient)
            }"
          ></div>
          <div class="h-40 relative flex-grow justify-between flex flex-col">
            <p class="m-0">
              ◄ {{ 'components.widget.settings.map.legend.high' | translate }}
            </p>
            <p class="m-0">
              ◄ {{ 'components.widget.settings.map.legend.low' | translate }}
            </p>
          </div>
        </div> -->
      </div>
    </div>
  </div>
</div>
