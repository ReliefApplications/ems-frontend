<div uiFormFieldDirective class="flex-1 w-44">
  <label>{{ label || 'common.field.one' | translate }}</label>
  <ui-select-menu [formControl]="fieldControl" #menu>
    <ui-select-option *ngIf="nullable">{{
      'common.input.none' | translate
    }}</ui-select-option>
    <ng-container
      *ngFor="let field of fields"
      [ngTemplateOutlet]="fieldNode"
      [ngTemplateOutletContext]="{
        $implicit: field,
        expansionSubTree: expansionTree[field.name]
      }"
    >
    </ng-container>
  </ui-select-menu>
</div>

<ng-template
  #fieldNode
  let-data
  let-parentName="parentName"
  let-expansionSubTree="expansionSubTree"
>
  <ui-select-option
    [value]="parentName ? parentName + '.' + data.name : data.name"
    *ngIf="data.type.kind === 'SCALAR'"
    #field
    >{{ data.name }}</ui-select-option
  >
  <ui-select-option
    [isGroup]="true"
    *ngIf="data.type.kind === 'LIST' || data.type.kind === 'OBJECT'"
  >
    <button
      (click)="
        toggleNodeExpansion(
          parentName ? parentName + '.' + data.name : data.name
        )
      "
      class="min-h-[32px] flex items-center w-full text-left overflow-hidden cursor-pointer text-blue-400"
    >
      <div class="default flex-1">
        <span class="block truncate font-bold">{{ data.name }}</span>
      </div>

      <!-- icon at right of the button -->
      <span class="pointer-events-none flex items-center">
        <svg
          class="h-5 w-5 text-gray-400"
          viewBox="0 0 20 20"
          fill="currentColor"
          aria-hidden="true"
        >
          <path
            fill-rule="evenodd"
            d="M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z"
            clip-rule="evenodd"
          />
        </svg>
      </span>
    </button>
    <ng-container *ngIf="expansionSubTree ? expansionSubTree.expanded : true">
      <ng-container
        *ngFor="let subField of data.fields"
        [ngTemplateOutlet]="fieldNode"
        [ngTemplateOutletContext]="{
          $implicit: subField,
          parentName: parentName ? parentName + '.' + data.name : data.name,
          expansionSubTree: expansionSubTree
            ? expansionSubTree[subField.name]
            : ''
        }"
      >
      </ng-container>
    </ng-container>
  </ui-select-option>
</ng-template>
