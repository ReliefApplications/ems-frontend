<safe-modal size="big" [closable]="true">
  <ng-container *ngIf="!loading">
    <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
      <safe-record-summary
        *ngIf="record"
        [record]="record"
        (showHistory)="onShowHistory()"
      ></safe-record-summary>
      <safe-form-actions *ngIf="survey" [survey]="survey"></safe-form-actions>
    </div>
    <div mat-dialog-title>
      <mat-tab-group
        animationDuration="0ms"
        [selectedIndex]="selectedTabIndex"
        (selectedIndexChange)="onShowPage($event)"
      >
        <mat-tab
          *ngFor="let page of pages$ | async"
          [label]="page.title ? page.title : page.name"
        >
          <ng-template mat-tab-label>
            {{ page.title ? page.title : page.name }}
            <safe-icon
              *ngIf="page.containsErrors"
              icon="error"
              variant="danger"
              [inline]="true"
              [size]="20"
            ></safe-icon>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </div>
  </ng-container>
  <mat-dialog-content class="grow max-h-full" #formContainer>
    <div *ngIf="loading" class="h-full flex">
      <safe-spinner class="m-auto block"></safe-spinner>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <safe-button (click)="onClose()" variant="danger">{{
      'common.cancel' | translate
    }}</safe-button>
    <ng-container *ngIf="pages$ | async as pages">
      <safe-button
        category="secondary"
        variant="primary"
        *ngIf="pages.length > 1"
        (click)="survey && survey.prevPage()"
        cdkFocusInitial
        [disabled]="!survey || survey.isFirstPage"
      >
        {{ 'common.previous' | translate }}
      </safe-button>
      <safe-button
        category="secondary"
        variant="primary"
        *ngIf="pages.length > 1"
        (click)="survey && survey.nextPage()"
        cdkFocusInitial
        [disabled]="!survey || survey.isLastPage"
      >
        {{ 'common.next' | translate }}
      </safe-button>
    </ng-container>
    <safe-button
      category="secondary"
      variant="primary"
      [disabled]="saving"
      (click)="submit()"
      cdkFocusInitial
    >
      {{ 'components.record.modal.update' | translate }}
    </safe-button>
  </mat-dialog-actions>
</safe-modal>
