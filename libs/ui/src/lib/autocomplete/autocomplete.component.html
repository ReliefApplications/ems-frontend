<form class="mt-2">
  <input
    [formControl]="formControl"
    type="text"
    matInput
    [placeholder]="placeholder"
    (click)="disabled ? '' : onOpen()"
    [ngModel]="optionSelected.label"
    aria-haspopup="autocomplete" aria-expanded="true" aria-labelledby="autocomplete-label"
    class="relative w-full rounded-md border-0 p-1.5 shadow-sm ring-1 ring-inset sm:leading-6 focus:ring-2 focus:ring-inset "
    [ngClass]="{
      'ring-red-300 focus:ring-red-400': formControl.invalid && formControl.touched,
      'ring-primary-300 focus:ring-primary-400': !disabled && (formControl.valid || formControl.untouched),
      'ring-gray-300': disabled
    }"
  >

  <div *ngIf="open && filteredOptions.length"
    class="z-10 p-1 max-h-60 w-full overflow-auto mt-2 rounded-md bg-white py-1 ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"
  >
    <ng-container  
      *ngTemplateOutlet="recursiveOptionsTemplate; context:{ list: filteredOptions }"  
    ></ng-container> 
  </div>
</form>

<ng-template #recursiveOptionsTemplate let-list="list">
  <ul
    id="autocomplete"
    *ngFor="let item of list; let i = index"
    class="z-20 mt-1 p-1 py-1 focus:outline-none sm:text-sm"
    role="autocomplete" aria-labelledby="autocomplete-label" aria-activedescendant="autocomplete-option-3"
    [ngClass]="{
      'cursor-pointer hover:bg-neutral-100': !item.children,
      'bg-neutral-200': item.selected
    }"
    (click)="!item.children ? onSelect(item) : ''"
    >
    {{item.label}}
    <li
      *ngIf="item.children"
      class="cursor-pointer text-gray-900 relative pl-2" id="autocomplete-option-{{i}}" role="option"
    >
      <ng-container
        *ngTemplateOutlet="recursiveOptionsTemplate; context:{ list: item.children }"
      ></ng-container>
    </li>
  </ul>
</ng-template>
