<div *ngIf="filteredPages.length">
  <h2>{{ 'common.workflow.few' | translate }}</h2>
  <table mat-table [dataSource]="filteredPages" multiTemplateDataRows>
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>
        {{ 'common.name' | translate }}
      </th>
      <td mat-cell *matCellDef="let element" class="font-bold">
        {{ element.name }}
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <div class="flex">
          <safe-button
            [isIcon]="true"
            [icon]="
              accessiblePages.includes(element.id)
                ? 'visibility'
                : 'visibility_off'
            "
            [variant]="
              accessiblePages.includes(element.id) ? 'primary' : 'grey'
            "
            (click)="onEditAccess(element)"
            [disabled]="loading"
            [matTooltip]="
              (accessiblePages.includes(element.id)
                ? 'components.role.tooltip.hideFeature'
                : 'components.role.tooltip.showFeature'
              ) | translate: { page: element.name }
            "
          >
          </safe-button>
          <safe-button
            [isIcon]="true"
            [icon]="
              openedWorkflowId === element.id
                ? 'keyboard_arrow_up'
                : 'keyboard_arrow_down'
            "
            (click)="toggleWorkflow(element)"
            [disabled]="loading"
          >
          </safe-button>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="expandedDetail">
      <td
        mat-cell
        *matCellDef="let element"
        [attr.colspan]="displayedColumns.length"
      >
        <div
          class="overflow-hidden flex justify-center"
          [@detailExpand]="
            element.id === openedWorkflowId ? 'expanded' : 'collapsed'
          "
        >
          <table
            class="my-4 mx-0"
            mat-table
            [dataSource]="filteredSteps"
            *ngIf="filteredSteps.length"
          >
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>
                {{ 'common.step.one' | translate }}
              </th>
              <td mat-cell *matCellDef="let element" class="font-bold">
                {{ element.name }}
              </td>
            </ng-container>
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let element">
                <safe-button
                  [isIcon]="true"
                  [icon]="
                    accessibleSteps.includes(element.id)
                      ? 'visibility'
                      : 'visibility_off'
                  "
                  [variant]="
                    accessibleSteps.includes(element.id) ? 'primary' : 'grey'
                  "
                  (click)="onEditStepAccess(element)"
                  [disabled]="loading"
                  [matTooltip]="
                    (accessiblePages.includes(element.id)
                      ? 'components.role.tooltip.hideFeature'
                      : 'components.role.tooltip.showFeature'
                    ) | translate: { page: element.name }
                  "
                >
                </safe-button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
          </table>
          <safe-empty
            class="py-3 px-0"
            *ngIf="filteredSteps.length === 0"
            [title]="'components.role.summary.noSteps' | translate"
          >
          </safe-empty>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: ['expandedDetail']"
      class="h-0"
    ></tr>
  </table>
</div>
