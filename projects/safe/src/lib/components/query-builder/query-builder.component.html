<ng-container *ngIf="form">
  <form [formGroup]="form" [ngClass]="{ 'field-form': isField }">
    <ng-container *ngIf="isField">
      <div class="form-group-row">
        <safe-button [isIcon]="true" icon="arrow_back" (click)="onCloseField()">
        </safe-button>
        <mat-form-field appearance="outline">
          <mat-label>{{ 'models.form.field.name' | translate }}</mat-label>
          <input matInput formControlName="name" type="text" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>{{ 'models.form.field.label' | translate }}</mat-label>
          <input matInput formControlName="label" type="text" />
        </mat-form-field>
      </div>
    </ng-container>
    <mat-tab-group
      mat-align-tabs="start"
      animationDuration="0ms"
      *ngIf="form.getRawValue().name"
    >
      <mat-tab [label]="'components.queryBuilder.fields.title' | translate">
        <ng-template matTabContent>
          <safe-tab-fields
            *ngIf="availableFields.length > 0"
            [form]="$any(form.controls.fields)"
            [fields]="availableFields"
          ></safe-tab-fields>
        </ng-template>
      </mat-tab>
      <mat-tab
        [label]="'components.queryBuilder.sort.title' | translate"
        *ngIf="form.get('sort')"
      >
        <ng-template matTabContent>
          <safe-tab-sort
            [form]="$any(form.controls.sort)"
            [fields]="availableScalarFields"
          ></safe-tab-sort>
        </ng-template>
      </mat-tab>
      <mat-tab
        [label]="'components.queryBuilder.pagination.title' | translate"
        *ngIf="showPagination && form.get('first')"
      >
        <ng-template matTabContent>
          <safe-tab-pagination [form]="form"></safe-tab-pagination>
        </ng-template>
      </mat-tab>
      <mat-tab
        [label]="'components.queryBuilder.filter.title' | translate"
        *ngIf="form.get('filter')"
      >
        <ng-template matTabContent>
          <safe-tab-filter
            [form]="$any(form.controls.filter)"
            [query]="form.getRawValue()"
          >
          </safe-tab-filter>
        </ng-template>
      </mat-tab>
      <mat-tab
        [label]="'components.queryBuilder.style.title' | translate"
        *ngIf="form.get('style')"
      >
        <ng-template matTabContent>
          <safe-tab-style
            [form]="$any(form.controls.style)"
            [scalarFields]="availableScalarFields"
            [query]="form.getRawValue()"
          >
          </safe-tab-style>
        </ng-template>
      </mat-tab>
      <mat-tab [label]="'common.preview' | translate" *ngIf="layoutPreviewData">
        <ng-template matTabContent>
          <safe-tab-layout-preview [data]="layoutPreviewData">
          </safe-tab-layout-preview>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </form>
</ng-container>
