<h1>{{roleForm?.get('name')?.value}}</h1>
<form [formGroup]="roleForm" *ngIf="roleForm" (ngSubmit)="onSubmit()">
    <mat-tab-group>
        <mat-tab [label]="'Summary'">
            <div class="form-group">
                <mat-form-field appearance="outline">
                    <mat-label>
                        {{'common.name' | translate}}
                    </mat-label>
                    <input matInput formControlName="name" type='text' />
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>
                        {{'models.application.description' | translate}}
                    </mat-label>
                    <textarea matInput formControlName="description" cdkTextareaAutosize
                        #autosize="cdkTextareaAutosize">
                        </textarea>
                </mat-form-field>
                <div class="checkbox-area">
                    <mat-checkbox formControlName="canSeeRoles">
                        {{'components.role.permissions.canSeeRoles' | translate}}
                    </mat-checkbox>
                    <mat-checkbox formControlName="canSeeUsers">
                        {{'components.role.permissions.canSeeUsers' | translate}}
                    </mat-checkbox>
                </div>
                <div class="users-area">
                    <h3>{{'common.user.few' | translate}}</h3>
                    <div *ngIf="roleUsers.length; else noUsers">
                        <p *ngFor="let user of roleUsers">{{user}}</p>
                    </div>
                    <ng-template #noUsers>
                        <div>
                            <p>{{'common.user.none' | translate}}</p>
                        </div>
                    </ng-template>
                </div>
            </div>
        </mat-tab>
        <mat-tab [label]="'Features'" *ngIf="inApp">
            <div class="searchbar">
                <mat-form-field appearance="outline">
                    <mat-icon matPrefix>search</mat-icon>
                    <input matInput type="search" [(ngModel)]="featuresSearch" [ngModelOptions]="{standalone: true}"
                        [placeholder]="'common.placeholder.search' | translate" (ngModelChange)="onFeaturesSearch()">
                </mat-form-field>
            </div>
            <ng-container *ngFor="let group of formattedFeatures">
                <mat-expansion-panel [expanded]="group.expanded">
                    <mat-expansion-panel-header (click)="saveFeaturesPanelExpansion(group.type)">
                        <mat-panel-title class="panel-header">
                            <mat-icon>{{group.icon}}</mat-icon>
                            {{('common.' + group.type + '.few') | translate}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>

                    <mat-list>
                        <mat-list-item *ngFor="let feature of group.features" (click)="changeFeatureVisibility(feature)">
                            <safe-icon icon="{{feature.canSee ? 'visibility' : 'visibility_off'}}" variant="{{feature.canSee ? 'primary' : 'grey'}}"></safe-icon>
                            {{feature.name}}
                        </mat-list-item>
                    </mat-list>

                </mat-expansion-panel>
            </ng-container>
            <div class="spacer"></div>
        </mat-tab>
        <mat-tab [label]="'Resources'" *ngIf="inApp">
            <div class="searchbar">
                <mat-form-field appearance="outline">
                    <mat-icon matPrefix>search</mat-icon>
                    <input matInput [formControl]="formsAndResourcesSearch" type="search"
                        [placeholder]="'common.placeholder.search' | translate">
                </mat-form-field>
            </div>
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title class=" panel-header">
                        {{'common.resource.few' | translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-list>
                    <mat-list-item *ngFor="let resource of resources" (click)="onEditPermissions()">
                        {{resource.name}}
                    </mat-list-item>
                </mat-list>
                <safe-button *ngIf="resourcesQueryInfo.hasNextPage" class="load-more-button" category="tertiary"
                    variant="primary" (click)="loadResources()" [loading]="!!resourcesQueryInfo.loading">Load more
                </safe-button>
            </mat-expansion-panel>
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title class="panel-header">
                        {{'common.form.few' | translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-list>
                    <mat-list-item *ngFor="let form of forms" (click)="onEditPermissions()">
                        {{form.name + (form.core? ' (core)' : '')}}
                    </mat-list-item>
                </mat-list>
                <safe-button *ngIf="formsQueryInfo.hasNextPage" class="load-more-button" category="tertiary"
                    variant="primary" (click)="loadForms()" [loading]="!!formsQueryInfo.loading">Load more
                </safe-button>
            </mat-expansion-panel>
            <div class="spacer"></div>
        </mat-tab>
        <mat-tab [label]="'Channels'">
            <div class="searchbar">
                <mat-form-field appearance="outline">
                    <mat-icon matPrefix>search</mat-icon>
                    <input matInput type="search" [(ngModel)]="channelsSearch" [ngModelOptions]="{standalone: true}"
                        [placeholder]="'common.placeholder.search' | translate" (ngModelChange)="onChannelsSearch()">
                </mat-form-field>
            </div>
            <ng-container *ngFor="let group of formattedChannels">
                <mat-expansion-panel *ngIf="group.channels.length > 0" [expanded]="group.expanded">
                    <mat-expansion-panel-header (click)="saveChannelsPanelExpansion(group.name)">
                        <mat-panel-title>
                            {{group.name}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="checkbox-area">
                        <mat-checkbox *ngFor="let channel of group.channels" [checked]="isChannelSubscribed(channel)">
                            {{channel.title}}
                        </mat-checkbox>
                    </div>
                </mat-expansion-panel>
            </ng-container>
            <div class="spacer"></div>
        </mat-tab>

    </mat-tab-group>
    <safe-button variant="primary" category="secondary" type="submit">{{ 'common.saveChanges' | translate }}
    </safe-button>
</form>