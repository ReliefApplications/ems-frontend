<h1>{{roleForm?.get('name')?.value}}</h1>
<form [formGroup]="roleForm" *ngIf="roleForm" (ngSubmit)="onSubmit()">
    <mat-tab-group>
        <mat-tab [label]="'Summary'">
            <div class="form-group">
                <mat-form-field appearance="outline">
                    <mat-label>
                        {{'common.name' | translate}}
                    </mat-label>
                    <input matInput formControlName="name" type='text' />
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>
                        {{'models.application.description' | translate}}
                    </mat-label>
                    <textarea matInput formControlName="description" cdkTextareaAutosize
                        #autosize="cdkTextareaAutosize">
                        </textarea>
                </mat-form-field>
                <div class="checkbox-area">
                    <mat-checkbox formControlName="canSeeRoles">
                        {{'components.role.permissions.canSeeRoles' | translate}}
                    </mat-checkbox>
                    <mat-checkbox formControlName="canSeeUsers">
                        {{'components.role.permissions.canSeeUsers' | translate}}
                    </mat-checkbox>
                </div>
                <div class="users-area">
                    <h3>{{'common.user.few' | translate}}</h3>
                    <div *ngIf="roleUsers.length; else noUsers">
                        <p *ngFor="let user of roleUsers">{{user}}</p>
                    </div>
                    <ng-template #noUsers>
                        <div>
                            <p>{{'common.user.none' | translate}}</p>
                        </div>
                    </ng-template>
                </div>
            </div>
        </mat-tab>
        <mat-tab [label]="'Features'" *ngIf="inApp">
            <div class="searchbar">
                <mat-form-field appearance="outline">
                    <mat-icon matPrefix>search</mat-icon>
                    <input matInput type="search" [(ngModel)]="featureSearch" [ngModelOptions]="{standalone: true}"
                        [placeholder]="'common.placeholder.search' | translate" (ngModelChange)="onFeatureSearch()">
                </mat-form-field>
            </div>
            <ng-container *ngFor="let group of formattedFeatures | keyvalue">
                <mat-expansion-panel *ngIf="group.value.length > 0">
                    <mat-expansion-panel-header>
                        <mat-panel-title class="panel-header">
                            <mat-icon>{{getFeatureIcon(group.key)}}</mat-icon>
                            {{('common.' + group.key + '.few') | translate}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>

                    <mat-list>
                        <mat-list-item *ngFor="let feature of group.value" (click)="changeFeatureVisibility(feature)">
                            <mat-icon>{{feature.canSee ? "visibility" : "visibility_off"}}</mat-icon>
                            {{feature.name}}

                        </mat-list-item>
                    </mat-list>

                </mat-expansion-panel>
            </ng-container>
            <div class="spacer"></div>
        </mat-tab>
        <mat-tab [label]="'Resources'" *ngIf="inApp">
            <div class="searchbar">
                <mat-form-field appearance="outline">
                    <mat-icon matPrefix>search</mat-icon>
                    <input matInput [formControl]="formsAndResourcesSearch" type="search"
                        [placeholder]="'common.placeholder.search' | translate">
                </mat-form-field>
            </div>
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title class=" panel-header">
                        {{'common.resource.few' | translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-list>
                    <mat-list-item *ngFor="let resource of resources" (click)="onEditAccess()">
                        {{resource.name}}
                    </mat-list-item>
                </mat-list>
                <safe-button *ngIf="resourcesQueryInfo.hasNextPage" class="load-more-button" category="tertiary"
                    variant="primary" (click)="loadResources()" [loading]="!!resourcesQueryInfo.loading">Load more
                </safe-button>
            </mat-expansion-panel>
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title class="panel-header">
                        {{'common.form.few' | translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-list>
                    <mat-list-item *ngFor="let form of forms" (click)="onEditAccess()">
                        {{form.name + (form.core? ' (core)' : '')}}
                    </mat-list-item>
                </mat-list>
                <safe-button *ngIf="formsQueryInfo.hasNextPage" class="load-more-button" category="tertiary"
                    variant="primary" (click)="loadForms()" [loading]="!!formsQueryInfo.loading">Load more
                </safe-button>
            </mat-expansion-panel>
            <div class="spacer"></div>
        </mat-tab>
        <mat-tab [label]="'Channels'">
            <div class="searchbar">
                <mat-form-field appearance="outline">
                    <mat-icon matPrefix>search</mat-icon>
                    <input matInput type="search" [(ngModel)]="channelSearch" [ngModelOptions]="{standalone: true}"
                        [placeholder]="'common.placeholder.search' | translate" (ngModelChange)="onChannelSearch()">
                </mat-form-field>
            </div>
            <ng-container *ngFor="let application of channelsFormatted | keyvalue">
                <mat-expansion-panel *ngIf="application.value.length > 0">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{application.key}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="checkbox-area">
                        <mat-checkbox *ngFor="let channel of application.value">
                            {{channel.title}}
                        </mat-checkbox>
                    </div>
                </mat-expansion-panel>
            </ng-container>
            <div class="spacer"></div>
        </mat-tab>

    </mat-tab-group>
    <safe-button variant="primary" category="secondary" type="submit">{{ 'common.saveChanges' | translate }}
    </safe-button>
</form>