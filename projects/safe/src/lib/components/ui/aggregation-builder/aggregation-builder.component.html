<safe-spinner *ngIf="loading"></safe-spinner>
<ng-container *ngIf="!loading">
  <div class="aggregation-data-source">
    <safe-forms-dropdown
      [forms$]="forms$"
      [sourceControl]="aggregationForm.controls.dataSource"
      (filter)="onFilterDataSource($event)"
      (scrolled)="onScrollDataSource($event)"
    ></safe-forms-dropdown>
    <safe-tagbox
      [choices$]="fields$"
      [parentControl]="aggregationForm.controls.sourceFields"
      [label]="'aggregation.sourceFields' | translate"
    ></safe-tagbox>
  </div>
  <div class="aggregation-builder-form">
    <safe-pipeline
      [fields$]="selectedFields$"
      [metaFields$]="metaFields$"
      [pipelineForm]="pipelineForm"
    ></safe-pipeline>
    <safe-series-mapping
      [fields$]="mappingFields$"
      [mappingForm]="aggregationForm.controls.mapping"
    ></safe-series-mapping>
  </div>
</ng-container>
