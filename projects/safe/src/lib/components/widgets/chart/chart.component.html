<div class="widget-container">
  <kendo-tilelayout-item-header *ngIf="header" class="widget-header">
    <span class="widget-title" [title]="settings.title">{{
      settings.title
    }}</span>
  </kendo-tilelayout-item-header>
  <ng-container *ngIf="!hasError">
    <safe-button
      *ngIf="export"
      [isIcon]="true"
      icon="get_app"
      class="export-button"
      (click)="onExport()"
    >
    </safe-button>
    <div class="chart-container" [style.flex-direction]=flexDirection>
      <safe-line-chart
        #chartWrapper
        class="widget-content"
        *ngIf="settings.chart.type === 'line'"
        [title]="settings.chart.title"
        [legendEvent]="legendEvent"
        [series]="series"
        [options]="options"
      ></safe-line-chart>
      <safe-pie-chart
        #chartWrapper
        class="widget-content"
        *ngIf="settings.chart.type === 'pie'"
        [title]="settings.chart.title"
        [legendEvent]="legendEvent"
        [series]="series"
        [options]="options"
      ></safe-pie-chart>
      <safe-donut-chart
        #chartWrapper
        class="widget-content"
        *ngIf="settings.chart.type === 'donut'"
        [title]="settings.chart.title"
        [legendEvent]="legendEvent"
        [series]="series"
        [options]="options"
      ></safe-donut-chart>
      <safe-column-chart
        #chartWrapper
        class="widget-content"
        *ngIf="settings.chart.type === 'column'"
        [title]="settings.chart.title"
        [legendEvent]="legendEvent"
        [series]="series"
        [options]="options"
      ></safe-column-chart>
      <safe-bar-chart
        #chartWrapper
        class="widget-content"
        *ngIf="settings.chart.type === 'bar'"
        [title]="settings.chart.title"
        [legendEvent]="legendEvent"
        [series]="series"
        [options]="options"
      ></safe-bar-chart>
      <div class="chart-legend"
        *ngIf="settings.chart.legend && settings.chart.legend.visible && legend.length > 0"
        [class.vertical]="settings.chart.legend.orientation === 'vertical'"
        [style.max-height]="this.settings.chart.legend.position === 'top' ||
        this.settings.chart.legend.position === 'bottom' ? '40%' : null"
      >
        <div
        *ngFor="let item of legend, let i = index"
        class="item"
        (click)="toggleSeries(item, i)"
        (mouseenter)="toggleSeriesHighlight(true, item.id ? item.id : item.value)"
        (mouseleave)="toggleSeriesHighlight(false, item.id ? item.id : item.value)"
        [class.item-inactive]="!item.active"
        >
          <div class="color" [style]="'background-color: ' + item.color"></div>
          <p>{{item.value}}<p>
        </div>
      </div>
    </div>
    <p class="widget-last-update" *ngIf="lastUpdate && lastUpdate.length > 0">
      Last update: {{ lastUpdate }}
    </p>
  </ng-container>
  <mat-spinner [diameter]="30" *ngIf="loading"></mat-spinner>
  <div *ngIf="hasError" class="chart-error">
    <safe-icon variant="danger" icon="error_outline"></safe-icon>
    <p color="danger">
      {{ 'components.widget.chart.errors.aggregation.invalid' | translate }}
    </p>
  </div>
</div>
