<safe-modal [closable]="true" size="fullscreen">
  <h1 mat-dialog-title>
    {{ 'components.widget.settings.summaryCard.card.title' | translate }}
  </h1>
  <mat-dialog-content>
    <form [formGroup]="form">
      <mat-tab-group
        #tabGroup
        (selectedTabChange)="handleTabChange($event)"
        [selectedIndex]="0"
      >
        <!-- Selection of data source -->
        <mat-tab
          [label]="
            'components.widget.settings.summaryCard.card.dataSource.title'
              | translate
          "
        >
          <safe-data-source-tab
            [form]="form"
            [selectedResource]="selectedResource"
            [selectedLayout]="selectedLayout"
            [selectedAggregation]="selectedAggregation"
            (layoutChange)="handleLayoutChange($event)"
            (aggregationChange)="handleAggregationChange($event)"
          ></safe-data-source-tab>
        </mat-tab>
        <!-- Selection of record -->
        <mat-tab
          [label]="
            'components.widget.settings.summaryCard.card.valueSelector.title'
              | translate
          "
          *ngIf="
            !form.get('isDynamic')?.value && !form.get('isAggregation')?.value
          "
        >
          <safe-value-selector-tab
            [form]="form"
            [settings]="selectedLayout"
          ></safe-value-selector-tab>
        </mat-tab>
        <!-- Card display settings -->
        <mat-tab [label]="'common.display' | translate">
          <safe-display-tab [form]="form"></safe-display-tab>
        </mat-tab>
        <!-- Card text editor -->
        <mat-tab
          [label]="
            'components.widget.settings.summaryCard.card.textEditor.title'
              | translate
          "
        >
          <safe-text-editor-tab
            *ngIf="isEditorTab()"
            [form]="form"
            [fields]="fields"
          ></safe-text-editor-tab>
        </mat-tab>
        <!-- Preview of card -->
        <mat-tab [label]="'common.preview' | translate">
          <safe-preview-tab
            [html]="form.value.html"
            [record]="selectedRecord"
            [fields]="fields"
          ></safe-preview-tab>
        </mat-tab>
      </mat-tab-group>
    </form>
  </mat-dialog-content>
  <!-- Modal actions ( close / save ) -->
  <div mat-dialog-actions class="mat-dialog-actions" align="end">
    <safe-button mat-dialog-close>
      {{ 'common.close' | translate }}
    </safe-button>
    <safe-button
      category="secondary"
      variant="primary"
      (click)="onSubmit()"
      cdkFocusInitial
      [disabled]="!form || !form.valid"
    >
      {{ 'common.save' | translate }}
    </safe-button>
  </div>
</safe-modal>
