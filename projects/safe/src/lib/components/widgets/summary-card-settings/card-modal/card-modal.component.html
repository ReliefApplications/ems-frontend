<safe-modal [closable]="true" size="fullscreen">
  <h1 mat-dialog-title>
    {{ 'components.widget.settings.summaryCard.card.title' | translate }}
  </h1>
  <mat-dialog-content>
    <form class="h-full" [formGroup]="form">
      <safe-tab-settings-options
        class="w-full"
        (selectedTabEvent)="handleTabChange($event)"
        [tabOptionsConfig]="tabSettingsConfig"
      >
        <ng-container ngProjectAs="[selectedTabTemplate]">
          <div [ngSwitch]="selectedTab">
            <!-- Selection of record -->
            <ng-container *ngSwitchCase="summaryCardSettingsTabTypes.RECORD">
              <safe-value-selector-tab
                [form]="form"
                [settings]="selectedLayout"
              ></safe-value-selector-tab>
            </ng-container>
            <!-- Card display settings -->
            <ng-container *ngSwitchCase="summaryCardSettingsTabTypes.SETTINGS">
              <safe-display-tab [form]="form"></safe-display-tab>
            </ng-container>
            <!-- Card text editor -->
            <ng-container *ngSwitchCase="summaryCardSettingsTabTypes.EDITOR">
              <safe-text-editor-tab
                [form]="form"
                [fields]="fields"
              ></safe-text-editor-tab>
            </ng-container>
            <!-- Preview of card -->
            <ng-container *ngSwitchCase="summaryCardSettingsTabTypes.PREVIEW">
              <safe-preview-tab
                [form]="form"
                [record]="selectedRecord"
                [fields]="fields"
                [layout]="form.value.isAggregation ? null : selectedLayout"
              ></safe-preview-tab>
            </ng-container>
            <!-- Selection of data source -->
            <ng-container *ngSwitchDefault>
              <safe-data-source-tab
                [form]="form"
                [selectedResource]="selectedResource"
                [selectedLayout]="selectedLayout"
                [selectedAggregation]="selectedAggregation"
                (layoutChange)="handleLayoutChange($event)"
                (aggregationChange)="handleAggregationChange($event)"
              ></safe-data-source-tab>
            </ng-container>
          </div>
        </ng-container>
      </safe-tab-settings-options>
    </form>
  </mat-dialog-content>
  <!-- Modal actions ( close / save ) -->
  <div mat-dialog-actions class="mat-dialog-actions" align="end">
    <safe-button mat-dialog-close>
      {{ 'common.close' | translate }}
    </safe-button>
    <safe-button
      category="secondary"
      variant="primary"
      (click)="onSubmit()"
      cdkFocusInitial
      [disabled]="!form || !form.valid"
    >
      {{ 'common.save' | translate }}
    </safe-button>
  </div>
</safe-modal>
