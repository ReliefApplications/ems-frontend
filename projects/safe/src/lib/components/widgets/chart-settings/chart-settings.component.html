<ng-container *ngIf="tileForm">
    <form [formGroup]="tileForm" class="widget-form-container">
        <div class="form-group">
            <div class="form-group-title">{{'global.general' | translate}}</div>
            <mat-form-field appearance="outline">
                <mat-label>{{'global.title' | translate}}</mat-label>
                <input matInput formControlName="title" type="string" />
            </mat-form-field>
            <ng-container formGroupName="chart" *ngIf="chartForm">
                <mat-form-field appearance="outline">
                    <mat-label>{{'widgets.chart.type' | translate}}</mat-label>
                    <mat-select formControlName="type">
                        <mat-select-trigger>
                            <img class="chart-icon" [src]="type.icon" />{{type.name | uppercase}}
                        </mat-select-trigger>
                        <mat-option *ngFor="let type of types" [value]="type.name">
                            <img class="chart-icon" [src]="type.icon" /> {{type.name | uppercase }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </ng-container>
        </div>
        <div formGroupName="chart" *ngIf="chartForm">
            <mat-tab-group animationDuration="0ms" preserveContent="true">
                <mat-tab [label]="'global.aggregation' | translate">
                    <safe-button icon="refresh" category="secondary" variant="primary" (click)="refreshPipeline()"
                        [disabled]="!pipelineChanged">
                        {{'action.apply' | translate}}
                    </safe-button>
                    <safe-aggregation-builder [rawPipelineForm]="chartForm.controls.pipeline" [settings]="settings.chart.aggregation"></safe-aggregation-builder>
                </mat-tab>
                <mat-tab [label]="'global.display' | translate">
                    <mat-accordion>
                        <mat-expansion-panel formGroupName="legend">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    {{'global.legend' | translate}}
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <mat-slide-toggle formControlName="visible">{{'global.display' | translate}}</mat-slide-toggle>
                            <ng-container *ngIf="chartForm.value.legend.visible">
                                <div>
                                    <h3>{{'global.position' | translate}}</h3>
                                    <div>
                                        <safe-button icon="{{ position.icon }}" category="secondary"
                                            [variant]="position.value === chartForm.value.legend.position ? 'primary' : ''"
                                            (click)="chartForm.patchValue({legend: { position: position.value }})"
                                            *ngFor="let position of legendPositions">
                                        </safe-button>
                                    </div>
                                </div>
                                <div>
                                    <h3>{{'global.orientation' | translate}}</h3>
                                    <div>
                                        <safe-button icon="{{ orientation.icon }}" category="secondary"
                                            [variant]="orientation.value === chartForm.value.legend.orientation ? 'primary' : ''"
                                            (click)="chartForm.patchValue({legend: { orientation: orientation.value }})"
                                            *ngFor="let orientation of legendOrientations">
                                        </safe-button>
                                    </div>
                                </div>
                            </ng-container>
                        </mat-expansion-panel>
                        <mat-expansion-panel formGroupName="title">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    {{'global.title' | translate}}
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <mat-slide-toggle formControlName="visible">{{'global.display' | translate}}</mat-slide-toggle>
                            <ng-container *ngIf="chartForm.value.title.visible">
                                <div>
                                    <mat-form-field appearance="outline">
                                        <mat-label>{{'global.text' | translate}}</mat-label>
                                        <input matInput formControlName="text">
                                    </mat-form-field>
                                </div>
                                <div>
                                    <h3>{{'global.position' | translate}}</h3>
                                    <div>
                                        <safe-button icon="{{ position.icon }}" category="secondary"
                                            [variant]="position.value === chartForm.value.title.position ? 'primary' : ''"
                                            (click)="chartForm.patchValue({title: { position: position.value }})"
                                            *ngFor="let position of titlePositions">
                                        </safe-button>
                                    </div>
                                </div>
                            </ng-container>
                        </mat-expansion-panel>
                    </mat-accordion>
                </mat-tab>
                <mat-tab [label]="'action.preview' | translate">
                    <safe-chart class="widget-content" [header]="false" [export]="false" [settings]="settings">
                    </safe-chart>
                </mat-tab>
            </mat-tab-group>
        </div>
    </form>
</ng-container>