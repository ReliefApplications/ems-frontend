<div [formGroup]="formGroup" class="flex flex-col">
  <!-- Header -->
  <h2>
    {{ 'components.widget.settings.grid.buttons.title' | translate }}
  </h2>
  <safe-alert class="mb-4">
    <safe-icon icon="info"></safe-icon>
    {{ 'components.widget.settings.grid.hint.buttons' | translate }}
  </safe-alert>
  <!-- Add new button -->
  <safe-button
    style.align-self="flex-end"
    icon="add"
    variant="primary"
    (click)="addButton($event)"
  >
    {{ 'components.widget.settings.grid.buttons.create' | translate }}
  </safe-button>
  <!-- Available buttons -->
  <mat-tab-group
    mat-align-tabs="start"
    animationDuration="0ms"
    dynamicHeight
    *ngIf="buttons.length > 0"
    #tabGroup
  >
    <ng-container
      *ngFor="
        let button of buttons.controls;
        let i = index;
        trackBy: trackByIndex
      "
    >
      <mat-tab>
        <!-- Button label - tab header -->
        <ng-template mat-tab-label>
          <div
            (cdkDropListDropped)="onDropTab($event)"
            [cdkDropListConnectedTo]="(tabIds$ | async)!"
            [id]="TAB_ID_NAME + i"
            cdkDropListOrientation="horizontal"
            cdkDropList
          >
            <div
              (cdkDragEntered)="onDragEntered($event)"
              (cdkDragExited)="onDragExited($event)"
              class="flex items-center"
              cdkDrag
            >
              <!-- Drag placeholder-->
              <div *cdkDragPlaceholder></div>
              <!-- Drag indicator -->
              <safe-icon
                cdkDragHandle
                class="draggable"
                icon="drag_indicator"
              ></safe-icon>
              <!-- Button name -->
              <span
                class="max-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap"
                >{{
                  button.value.name.length > 0
                    ? button.value.name
                    : ('components.widget.settings.grid.buttons.defaultName'
                      | translate)
                }}
              </span>
              <!-- Error indicator -->
              <safe-icon
                *ngIf="button.invalid"
                icon="error_outline"
                variant="danger"
                [inline]="true"
                [size]="18"
              ></safe-icon>
            </div>
          </div>
        </ng-template>
        <!-- Button form - tab content -->
        <ng-template matTabContent>
          <safe-button-config
            [formGroup]="$any(button)"
            [fields]="fields"
            [channels]="channels"
            [templates]="templates"
            [distributionLists]="distributionLists"
            [relatedForms]="relatedForms"
            (deleteButton)="deleteButton(i)"
          >
          </safe-button-config>
        </ng-template>
      </mat-tab>
    </ng-container>
  </mat-tab-group>
</div>
