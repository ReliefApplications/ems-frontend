<mat-spinner diameter="45" class="page-loader" *ngIf="loading"></mat-spinner>
<ng-container *ngIf="!loading && form">
  <!-- Page header -->
  <div class="flex flex-wrap items-center justify-between mb-6 gap-4">
    <div class="flex items-center overflow-hidden">
      <!-- Page name -->
      <ng-container *ngIf="!formActive">
        <h1
          class="!m-0 overflow-hidden text-ellipsis hover:bg-neutral-200 rounded-lg"
          (click)="toggleFormActive()"
        >
          {{ page ? page.name : step ? step.name : '' }}
        </h1>
      </ng-container>
      <!-- Name edition -->
      <ng-container *ngIf="formActive">
        <form [formGroup]="tabNameForm" (ngSubmit)="saveName()">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.name' | translate }}</mat-label>
            <input matInput formControlName="tabName" type="string" />
            <safe-button
              matSuffix
              type="submit"
              [isIcon]="true"
              icon="done"
              variant="primary"
              [disabled]="!tabNameForm.valid"
            ></safe-button>
            <safe-button
              matSuffix
              [isIcon]="true"
              icon="close"
              variant="danger"
              (click)="toggleFormActive()"
            ></safe-button>
          </mat-form-field>
        </form>
      </ng-container>
      <!-- Page access -->
      <safe-access
        [access]="page ? page.permissions : step ? step.permissions : null"
        [application]="applicationId"
        [objectTypeName]="'common.page.one' | translate"
        (save)="saveAccess($event)"
        *ngIf="
          !formActive && (page ? page.canUpdate : step ? step.canUpdate : false)
        "
      ></safe-access>
    </div>
    <!-- Page actions -->
    <div class="flex items-center" *ngIf="!formActive">
      <!-- Edit name -->
      <safe-button
        icon="edit"
        category="secondary"
        variant="primary"
        (click)="editForm()"
        *ngIf="form.canUpdate"
      >
        {{
          'common.editObject'
            | translate: { name: 'common.form.one' | translate }
        }}
      </safe-button>
    </div>
  </div>
  <!-- Form -->
  <safe-form [form]="form" (save)="onComplete($event)"></safe-form>
  <!-- Form actions -->
  <div
    class="mt-6 flex justify-center"
    *ngIf="completed && !form.uniqueRecord && !hideNewRecord"
  >
    <!-- New record -->
    <safe-button
      class="flex-1 max-w-xs"
      variant="primary"
      category="secondary"
      (click)="clearForm()"
      >{{ 'models.record.new' | translate }}</safe-button
    >
  </div>
</ng-container>
