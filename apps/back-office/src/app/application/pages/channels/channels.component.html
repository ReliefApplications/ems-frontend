<mat-spinner diameter="45" class="page-loader" *ngIf="loading"></mat-spinner>
<ng-container *ngIf="!loading">
  <div class="mb-4 flex flex-row justify-end">
    <ui-button
      icon="add"
      [category]="btnCategory.SECONDARY"
      [variant]="btnVariant.PRIMARY"
      (click)="onAdd()"
    >
      {{ 'models.channel.create' | translate }}
    </ui-button>
  </div>
  <!-- Table container -->
  <div class="overflow-x-hidden shadow-2lg">
    <!-- Table scroll container -->
    <div class="overflow-x-auto">
      <table mat-table [dataSource]="channelsData">
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>
            {{ 'common.title' | translate }}
          </th>
          <td mat-cell *matCellDef="let element" class="font-bold">
            {{ element.title }}
          </td>
        </ng-container>
        <ng-container matColumnDef="subscribedRoles">
          <th mat-header-cell *matHeaderCellDef>
            {{ 'common.role.few' | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            <span
              *ngFor="
                let subscribedApplication of element.subscribedApplications
              "
            >
              <span *ngIf="subscribedApplication.roles.length > 0"
                >[{{ subscribedApplication.name }}] :
              </span>
              <span *ngFor="let role of subscribedApplication.roles">
                <span> {{ role.title }}, </span>
              </span>
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="recordsCount">
          <th mat-header-cell *matHeaderCellDef>Records</th>
          <td mat-cell *matCellDef="let element">{{ element.recordsCount }}</td>
        </ng-container>

        <ng-container matColumnDef="actions" [stickyEnd]="true">
          <th mat-header-cell *matHeaderCellDef class="w-16"></th>
          <td mat-cell *matCellDef="let element">
            <ui-button
              [isIcon]="true"
              icon="more_vert"
              [uiMenuTriggerFor]="menu"
              (click)="$event.stopPropagation()"
            >
            </ui-button>
            <ui-menu #menu>
              <button uiMenuItem (click)="onEdit(element)">
                <mat-icon>edit</mat-icon>
                {{ 'common.edit' | translate }}
              </button>
              <ui-divider class="m-0"></ui-divider>
              <button uiMenuItem (click)="onDelete(element)">
                <mat-icon>delete</mat-icon>
                {{ 'common.delete' | translate }}
              </button>
            </ui-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
      </table>
    </div>
  </div>
</ng-container>
