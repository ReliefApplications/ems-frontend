<!-- Header -->
<h2>{{ 'common.filter.few' | translate }}</h2>

<!-- No filters template -->
<div *ngIf="filters.length === 0" class="flex flex-col p-4 items-center">
  <ui-icon icon="folder_open"></ui-icon>
  <h3>{{ 'components.triggers.noFilters' | translate }}</h3>
</div>

<!-- Table container -->
<div class="overflow-x-hidden shadow-2lg">
    <!-- Table scroll container -->
    <div class="overflow-x-auto">
      <table
        cdk-table
        uiTableWrapper
        [dataSource]="filters"
        *ngIf="filters.length > 0"
        multiTemplateDataRows
      >
        <ng-container cdkColumnDef="filter">
          <th uiCellHeader *cdkHeaderCellDef scope="col">
            {{ 'components.queryBuilder.filter.title' | translate }}
          </th>
          <td uiCell *cdkCellDef="let element">
            {{ filtersService.getAccessString(element.filter) }}
          </td>
        </ng-container>
        <ng-container cdkColumnDef="actions" [stickyEnd]="true">
          <th uiCellHeader *cdkHeaderCellDef scope="col" class="text-end w-16">
            <ui-button
              [disabled]="disabled"
              variant="primary"
              category="tertiary"
              (click)="save()"
              >{{ 'common.save' | translate }}</ui-button
            >
          </th>
          <td uiCell *cdkCellDef="let element; let i = dataIndex">
            <div class="flex">
              <ng-container *ngFor="let trigger of element.triggers">
                <ui-button
                  [disabled]="disabled"
                  [isIcon]="true"
                  [icon]="trigger.icon"
                  [variant]="trigger.variant"
                  [uiTooltip]="trigger.tooltip | translate"
                  (click)="
                    $event.stopPropagation();
                    toggleFilterTrigger(i, trigger.name)
                  "
                >
                </ui-button>
              </ng-container>
            </div>
          </td>
        </ng-container>
        <ng-container cdkColumnDef="expandedDetail">
          <td
            uiCell
            *cdkCellDef="let element; let i = dataIndex"
            [attr.colspan]="displayedColumns.length"
            [ngClass]="i === openedFilterIndex ? '' : 'hidden'"
          >
            <div
              class="expanded-filter"
              [@detailExpand]="i === openedFilterIndex ? 'expanded' : 'collapsed'"
            >
              <shared-filter
                *ngIf="i === openedFilterIndex"
                [form]="openedFilterFormGroup!"
                [fields]="filterFields"
              >
              </shared-filter>
              <ui-button
                *ngIf="i === openedFilterIndex"
                [disabled]="disabled"
                variant="danger"
                category="secondary"
                icon="delete"
                (click)="deleteFilter(i)"
                class="w-fit"
              >
                {{ 'components.role.summary.removeFilter' | translate }}
              </ui-button>
            </div>
          </td>
        </ng-container>

        <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
        <tr
          *cdkRowDef="let row; columns: displayedColumns; let i = dataIndex"
          cdk-row
          (click)="toggleFilterEdition(i)"
          class="cursor-pointer"
        ></tr>
        <tr cdk-row *cdkRowDef="let row; columns: ['expandedDetail']"></tr>
      </table>
    </div>
</div>


<!-- Add filter button -->
<ui-button
  [disabled]="disabled"
  variant="primary"
  category="secondary"
  (click)="addFilter()"
  class="self-center"
>
  {{ 'components.role.summary.addFilter' | translate }}
</ui-button>
