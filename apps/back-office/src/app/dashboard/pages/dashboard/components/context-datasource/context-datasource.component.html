<ui-dialog size="medium" [closable]="true">
  <ng-container ngProjectAs="header">
    <h2>{{ 'models.dashboard.context.datasource.title' | translate }}</h2>
  </ng-container>

  <ng-container ngProjectAs="content">
    <ng-container *ngIf="form">
      <form [formGroup]="form" class="flex justify-between w-full flex-col m-2">
        <ui-alert class="mb-6">
          {{ 'models.dashboard.context.datasource.alert' | translate }}
        </ui-alert>
        <!-- Origin -->
        <div uiFormFieldDirective [outline]="false" class="mb-2">
          <label>{{ 'models.dashboard.context.origin' | translate }}</label>
          <ui-select-menu formControlName="origin">
            <ui-select-option
              value="resource"
              [label]="'common.resource.one' | translate"
            >
              {{ 'common.resource.one' | translate }}
            </ui-select-option>
            <ui-select-option
              value="refData"
              [label]="'common.referenceData.one' | translate"
            >
              {{ 'common.referenceData.one' | translate }}
            </ui-select-option>
          </ui-select-menu>
        </div>

        <!-- Resource selection -->
        <mat-form-field
          appearance="outline"
          class="grow"
          *ngIf="form.get('origin')?.value === 'resource'"
        >
          <mat-label>{{ 'common.resource.one' | translate }}</mat-label>

          <safe-graphql-select
            *ngIf="resourcesQuery"
            valueField="id"
            textField="name"
            [query]="resourcesQuery"
            formControlName="resource"
            [selectedElements]="[resource]"
            (searchChange)="onResourceSearchChange($event)"
            [filterable]="true"
          >
          </safe-graphql-select>
        </mat-form-field>

        <!-- Reference data selection  -->
        <mat-form-field
          appearance="outline"
          class="grow"
          *ngIf="form.get('origin')?.value === 'refData'"
        >
          <mat-label>{{ 'common.referenceData.one' | translate }}</mat-label>
          <safe-graphql-select
            *ngIf="refDatasQuery"
            valueField="id"
            textField="name"
            [query]="refDatasQuery"
            formControlName="refData"
            [selectedElements]="[refData]"
          >
          </safe-graphql-select>
        </mat-form-field>

        <!-- Field selection -->
        <div uiFormFieldDirective [outline]="false">
          <label>{{
            'models.dashboard.context.displayField' | translate
          }}</label>
          <ui-select-menu formControlName="displayField">
            <ui-select-option
              *ngFor="let field of availableFields"
              [value]="field"
              [label]="field"
              uiPrefix
            >
              {{ field }}
            </ui-select-option>
          </ui-select-menu>
          <safe-icon
            icon="info"
            class="cursor-pointer"
            variant="'grey'"
            uiSuffix
            [uiTooltip]="'models.dashboard.context.datasource.info' | translate"
          ></safe-icon>
        </div>
      </form>
      <ui-button
        category="secondary"
        variant="primary"
        (click)="onSubmit()"
        cdkFocusInitial
        [disabled]="!form.valid || !!form.get('displayField')?.disabled"
        class="ml-auto"
      >
        {{
          (data
            ? 'models.dashboard.context.datasource.update'
            : 'models.dashboard.context.datasource.set'
          ) | translate
        }}
      </ui-button>
    </ng-container>
  </ng-container>
</ui-dialog>
